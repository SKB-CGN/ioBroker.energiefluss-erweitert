<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Energiefluss - erweitert *Configuration*</title>
    <meta name=description content="Provides an animated energy-flow">
    <link rel="manifest" href="manifest.json">
    <link class=favicon rel=icon type=image/ico href="img/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#538ea3">
    <meta name="theme-color" content="#538ea3">
    <!-- Load ioBroker scripts and styles-->

    <link rel="stylesheet" href="style/style.css">

    <!--<script src="http://192.168.2.19:8082/energiefluss-erweitert/js/functions.js"></script>-->
    <script src="js/jquery-3.6.4.min.js"></script>
    <script src="js/jscolor.min.js"></script>
    <style>
        .input_text {}
    </style>
    <script>

        let globalConfig = { "basic": { "enable_grid": true, "enable_animation": true, "enable_area_catch": true, "height": "600", "width": "600" }, "animation": { "stroke": "#ffce4a", "stroke_dasharray": "6 12 6 12 6 12 6 76", "stroke_width": "10", "animation_duration": "2001", "stroke_linecap": "round", "animation_timing_function": "linear" }, "animation_configuration": { "dots": "4", "distance": "12", "length": "6" }, "line": { "stroke_width": "8", "stroke": "#000000" }, "elements": { "2": { "type": "text", "subType": "datasource", "id": "2", "pos_x": "217", "pos_y": "44", "color": "none", "fill": "rgb(255, 206, 74)", "font_family": "\"Arial\", sans-serif", "font_size": "18", "degree": 0, "text": "ID 2", "unit": "kW", "source": "sonnen.0.status.production", "shadow": "", "threshold": 0, "calculate_kw": true, "decimal_places": 2 }, "5": { "type": "rect", "id": "5", "rx": "10", "height": "100", "width": "100", "pos_x": "167", "pos_y": "2.5", "fill": "none", "color": "rgb(255, 206, 74)", "stroke": "2", "shadow": "rgba(0,0,0,0.7)" }, "6": { "type": "icon", "id": "6", "icon": "mdi:solar-panel", "width": 24, "height": 24, "color": "rgb(97, 104, 122)", "pos_x": "205", "pos_y": "6", "shadow": "" }, "7": { "type": "rect", "id": "7", "rx": "10", "height": "100", "width": "100", "pos_x": "407", "pos_y": "212", "fill": "none", "color": "rgb(0, 181, 221)", "stroke": "2", "shadow": "rgba(0,0,0,0.7)" }, "9": { "type": "text", "subType": "datasource", "id": "9", "pos_x": "457", "pos_y": "254", "color": "none", "fill": "rgb(0, 181, 221)", "font_family": "\"Arial\", sans-serif", "font_size": "20", "degree": 0, "text": "ID 9", "unit": "kW", "source": "sonnen.0.status.consumption", "shadow": "", "threshold": 0, "calculate_kw": true, "decimal_places": 2 }, "10": { "type": "text", "id": "10", "pos_x": "217", "pos_y": "76", "color": "none", "fill": "rgb(97, 104, 122)", "font_family": "\"Arial\", sans-serif", "font_size": "14", "degree": 0, "text": "Produktion", "shadow": "" }, "11": { "type": "text", "id": "11", "pos_x": "457", "pos_y": "288", "color": "none", "fill": "rgb(97, 104, 122)", "font_family": "\"Arial\", sans-serif", "font_size": "14", "degree": 0, "text": "Verbrauch", "shadow": "" }, "12": { "type": "icon", "id": "12", "icon": "mdi:house-city", "width": 24, "height": 24, "color": "rgb(97, 104, 122)", "pos_x": "445", "pos_y": "218", "shadow": "" }, "13": { "type": "rect", "id": "13", "rx": "10", "height": "100", "width": "100", "pos_x": "46", "pos_y": "206", "fill": "none", "color": "rgb(57, 208, 92)", "stroke": "5", "shadow": "" } }, "defs": { "path_5_7": { "type": "def", "id": "path_5_7", "d": "M237 103 V 124.6 A 15 15 0 0 0 252 139.6 H 422 A 15 15 0 0 1 437 154.6 V 211", "startSlot": "bottom_right", "endSlot": "top_left" }, "path_5_13": { "type": "def", "id": "path_5_13", "d": "M217 103 V 123.2 A 15 15 0 0 1 202 138.2 H 111 A 15 15 0 0 0 96 153.2 V 204", "startSlot": "bottom", "endSlot": "undefined" } }, "lines": { "line_path_5_7": { "type": "line", "id": "line_path_5_7", "href": "#path_5_7", "color": "rgb(0, 0, 0)" }, "line_path_5_13": { "type": "line", "id": "line_path_5_13", "href": "#path_5_13", "color": "rgb(0, 0, 0)" } }, "animations": { "anim_path_5_7": { "type": "animation", "id": "anim_path_5_7", "href": "#path_5_7", "color": "rgb(255, 206, 74)", "sources": [2, 9] }, "anim_path_5_13": { "type": "animation", "id": "anim_path_5_13", "href": "#path_5_13", "color": "rgb(255, 206, 74)", "sources": [2, 9] } }, "icons": {} };
        // These options apply to all color pickers on the page
        jscolor.presets.default = {
            format: 'rgba',
            borderColor: '#538EA3',
            borderRadius: 10,
            controlBorderColor: '#538EA3',
            previewSize: 28,
            previewPosition: 'right',
            required: false
        };

        $(document).ready(function () {
            $('#elm_rx')[0].jscolor.fromString('rgba(220,69,95,0.5)');
        });

        let needle = 'anim_path_5_7';
        let rawValues = { 2: 900, 9: 400, 10: 450 };
        let threshold = 401;
        /*
        let animationObject = { "2": { "animations": ["anim_path_5_7", "anim_hehe_0_9"] }, "9": { "animations": ["anim_path_5_7"] }, "18": { "animations": ["anim_path_0_7"] } };
        //console.log(animationObject);
        let tmpAnimArray = new Array();
        for (var key of Object.keys(animationObject)) {
            //console.log("ID: " + key);
            for (var key_under in animationObject[key]) {
                let tmpArr = animationObject[key][key_under];
                if (tmpArr.find(el => el === needle)) {
                    tmpAnimArray.push(key);
                }
            }
        }
        // IDs for Animation found - check their values
        let animationValid = true;
        for (let i = 0; i < tmpAnimArray.length; i++) {
            if (rawValues[tmpAnimArray[i]] < threshold) {
                animationValid = false;
                break;
                //console.log("ID: " + i + ' good to go!');
            }
        }
        console.log(animationValid);
        //console.log(tmpAnimArray);
        */
        /*
        let animationObject = {
            "anim_path_5_7": [2, 9],
            "anim_path_5_8": [2, null],
            "anim_path_5_6": [2, 10]
        }
        */
        let id = 2;
        //let tmpAnimpath;


        function getAnimationPath(id) {
            let tmpArr = new Array;
            for (var key of Object.keys(globalConfig.animations)) {
                for (var _key in globalConfig.animations[key].sources) {
                    if (globalConfig.animations[key].sources[_key] === id) {
                        tmpArr.push(key);
                    }
                    if (globalConfig.animations[key].sources[_key] === null) {
                        let index = tmpArr.indexOf(key);
                        if (index > -1) {
                            console.log(key);
                            tmpArr.splice(index, 1);
                        }
                    }
                }
            }
            return tmpArr;
        }

        //console.log(getAnimationPath(id));
        // Animations found - check the Values
        let tmpAnimArray = getAnimationPath(id);
        //console.log(tmpAnimArray);
        // Loop through animations
        for (var key in tmpAnimArray) {
            let animationValid = true;
            //console.log(tmpAnimArray[key]);
            // Loop through each Value of the Animation
            for (var _key in globalConfig.animations[tmpAnimArray[key]].sources) {
                let i = globalConfig.animations[tmpAnimArray[key]].sources[_key];
                //console.log(i);
                if (rawValues[i] < threshold) {
                    animationValid = false;
                    break;
                }
            }
            //console.log('Animation: ' + tmpAnimArray[key] + ' Valid: ' + animationValid);
        }
        for (let i = 0; i < tmpAnimArray.length; i++) {
            let animationValid = true;
            let tmpArr = new Array();
            tmpArr.push(tmpAnimArray[i]);

            // Loop through animations in Config
            /*
for (let j = 0; j < tmpArr.length; j++) {
    // Loop through each Value
    for (let k = 0; k < animationObject[tmpArr[j]].length; k++) {
        if (rawValues[animationObject[tmpArr[j]][k]] < threshold) {
            animationValid = false;
            break;
        }
    }
}
*/
            //console.log('Animation: ' + tmpAnimArray[i] + ' Valid: ' + animationValid);
        }

        let hm = {
            "animations": {
                "anim_path_5_7": {
                    "type": "animation",
                    "id": "anim_path_5_7",
                    "href": "#path_5_7",
                    "color": "rgb(255, 206, 74)",
                    "sources": [
                        null,
                        null
                    ],
                    "threshold": 250,
                    "animation": 0,
                    "animation_properties": "positive"
                },
                "anim_path_5_13": {
                    "type": "animation",
                    "id": "anim_path_5_13",
                    "href": "#path_5_13",
                    "color": "rgb(255, 206, 74)",
                    "sources": [
                        null,
                        null
                    ],
                    "threshold": "undefined",
                    "animation": -1,
                    "animation_properties": "negative"
                },
                "anim_path_14_7": {
                    "type": "animation",
                    "id": "anim_path_14_7",
                    "href": "#path_14_7",
                    "color": "rgb(255, 206, 74)",
                    "sources": [
                        null,
                        null
                    ],
                    "threshold": "undefined",
                    "animation": -1,
                    "animation_properties": "negative"
                },
                "anim_path_5_14": {
                    "type": "animation",
                    "id": "anim_path_5_14",
                    "href": "#path_5_14",
                    "color": "rgb(255, 206, 74)",
                    "sources": [
                        null,
                        null
                    ],
                    "threshold": "undefined",
                    "animation": 0,
                    "animation_properties": "positive"
                },
                "anim_path_7_22": {
                    "type": "animation",
                    "id": "anim_path_7_22",
                    "href": "#path_7_22",
                    "color": "rgb(255, 206, 74)",
                    "sources": [
                        null,
                        null
                    ],
                    "threshold": 0,
                    "animation": "",
                    "animation_properties": "positive"
                }
            }
        }

        let test = {
            0: {
                "source": "This"
            },
            "-1": {
                "source": "Hehe"
            }
        };

        for (var key of Object.keys(hm.animations)) {
            const value = hm.animations[key];
            if (value.animation.length !== 0) {
                //console.log("The Value is not null or empty: " + value.animation)
                console.log(test[value.animation].source);
            } else {
                console.log("One is empty!");
            }
            console.log(value.animation);
        }

    </script>
</head>

<body class="noscroll">
    <div class="form_div">
        <input type="text" class="input_text elm_config" min="0" value="" name="elm_rx" id="elm_rx" placeholder=""
            data-jscolor="{}">
        <label for="elm_rx" class="form_label">Rounded Corner</label>
    </div>
    <div style="width:350px;">
        <div class="detail_box elm_config_circle elm_config_rect elm_config_svg" style="">
            <span class="config_sec">Hehe</span>
        </div>
    </div>

</body>

</html>