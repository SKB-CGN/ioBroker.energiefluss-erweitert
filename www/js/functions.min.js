const urlParams=new URLSearchParams(window.location.search),instance=urlParams.get("instance")?urlParams.get("instance"):0;let adapterNameNamespace="energiefluss-erweitert."+instance;console.log("Using Instance: "+adapterNameNamespace);let objID=[adapterNameNamespace+".configuration",adapterNameNamespace+".data","system.adapter."+adapterNameNamespace+".alive"];systemLang=navigator.language||navigator.userLanguage;let backup_configuration={},configuration_default={line:{stroke_width:8,stroke:"#000000"},basic:{enable_grid:!0,enable_animation:!1,enable_area_catch:!0,enable_config_icon:!0,enable_last_id:!1,height:600,width:800,styles:"",font:{family:'"Arial", sans-serif',size:20},rect:{height:100,width:100,corners:10},circle:{radius:50},elm:{stroke_width:5},icon:{width:24,height:24}},animation:{stroke:"#ffce4a",stroke_dasharray:"4 12 4 12 4 100",stroke_width:6,animation_duration:2e3,stroke_linecap:"round",animation_timing_function:"linear"},animation_configuration:{dots:4,distance:12,length:6},animations:{},lines:{}},configuration=configuration_default,displayMode=!1,localMode=!1,globalConfigChanged=!1,basicConfig=!1,globalSelectedId,globalLastSteps={},globalAdapterOnline=!1,globalTmpCSS,globalIconProxy=!1,globalIconProxyPort=10123,max_elm_id=0,restore={};var url=window.location.pathname,hostname=window.location.hostname;"file:"==window.location.protocol&&(localMode=!0,console.log("Local Mode activated!"));var filename=url.substring(url.lastIndexOf("/")+1);filename.includes("index")||""==filename?displayMode=!0:jscolor.presets.default={alphaChannel:"auto",format:"any",borderColor:"#538EA3",borderRadius:10,controlBorderColor:"#538EA3",previewSize:28,previewPosition:"right",required:!1,palette:["#00b5dd","#61687a","#ffce4a","#a1d343","#c5902e","#f20e40"]};let multiselect_options={columns:1,search:!0,minWidth:250,maxWidth:300,maxPlaceholderOpts:5,texts:{placeholder:translateWord("opt_select_source"),search:translateWord("lbl_search"),selectedOptions:" "+translateWord("lbl_selected")}},selectId,iobObjects,iobArray=[];var iobPath=location.pathname,iobParts=iobPath.split("/");iobParts.splice(-3),location.pathname.match(/^\/admin\//)&&(iobParts=[]);let socket;if(socket=localMode?io.connect("http://192.168.2.19:8082/",{path:"/socket.io",reconnectionDelay:500,reconnectionAttempts:1/0}):io.connect("/",{path:iobParts.join("/")+"/socket.io",reconnectionDelay:500,reconnectionAttempts:1/0}),!displayMode){let e=new Date().toLocaleString();socket.on("connect",function(){console.log("[Socket] connected! at "+e),socket.emit("getObject","system.config",function(e,t){!e&&t&&t.common&&(systemLang=t.common.language||systemLang,translateAll())}),socket.emit("getObjects",function(e,t){!e&&t&&(iobObjects=Object.keys(t).sort().reduce((e,a)=>(e[a]=t[a],e),{}),console.log("Generating Tree ..."),generateStateTree(iobObjects,"stateExplorer"))})})}function sprintf(e){var t=Array.prototype.slice.call(arguments,1),a=0;return e.replace(/%s/g,function(){return t[a++]})}function isMobileDevice(){return window.matchMedia("only screen and (max-width: 760px)").matches}function displayLoading(e){$("#loading_text").html(e),$("#loading, .loading-spinner, #loading_text").show()}function displayListener(){let e=new Date().toLocaleString();localMode||(socket.emit("subscribe",objID),console.log("[Socket] subscribed to: "+objID.toString()+" at "+e),socket.on("connect",function(){console.log("[Socket] connected! at "+e)}),socket.on("reconnect",function(){console.log("[Socket] reconnected at "+e),$("#loading").fadeOut("fast")}),socket.on("disconnect",function(){console.log("[Socket] disconnected "+e),displayLoading(translateWord("msg_reconnect"))}),socket.on("objectChange",function(e,t){}),socket.on("stateChange",function(t,a){setTimeout(function(){if(t==objID[0])try{displayLoading(translateWord("msg_loading_config")),configuration=JSON.parse(a.val),setLoadedConfig(!0),console.log("Applied new configuration at "+e)}catch(i){console.log("Error while parsing Config in JSON-Object!")}if(t==objID[1])try{refreshData(JSON.parse(a.val))}catch(r){console.log("Error while parsing Values in JSON-Object!")}if(t==objID[2]){if(!1==a.val)displayLoading(sprintf(systemDictionary.msg_instance_loading[systemLang],instance)),console.log("Adapter instance: "+instance+" is not started! "+e),globalAdapterOnline=!1;else if(a.val!=globalAdapterOnline&&!0==a.val){console.log("Adapter instance: "+instance+" started at "+e),globalAdapterOnline=!0;let o=(Math.random()+1).toString(36).substring(7);window.location.href="?instance="+instance+"&hash="+o}}},0)}),socket.on("reauthenticate",function(){console.log("[Socket] reauthenticate "+e)}),socket.on("error",function(t){console.error("[Socket] error: "+t+" "+e)}),socket.on("connect_error",function(t){console.error("[Socket] connect error: "+t+" "+e)}),socket.on("permissionError",function(t){console.error("[Socket] permission error: "+t+" "+e)}))}function addGradient(e,t,a=90){""==t&&(t="transparent");let i=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");i.setAttribute("id","gradient_"+e),i.setAttribute("gradientTransform","rotate("+a+",0.5,0.5)");let r=document.createElementNS("http://www.w3.org/2000/svg","stop");r.setAttribute("id","gradient_transparent_"+e),r.setAttribute("offset","0%"),r.setAttribute("stop-color","transparent"),i.appendChild(r),(r=document.createElementNS("http://www.w3.org/2000/svg","stop")).setAttribute("id","gradient_color_"+e),r.setAttribute("stop-color",t),i.appendChild(r),$(i).appendTo("#placeholder_defs"),$("#"+e).css("fill","url(#gradient_"+e+")")}function updateGradient(e,t,a){try{let i=$("#"+e).data("fill_max"),r;switch(a){case"percent":r=100-t;break;case"value":if(!i)throw Error("No max value for element declared!");r=100-t/i*100}void 0!=r&&$("#gradient_transparent_"+e).attr("offset",r+"%")}catch(o){console.error("Error while updating gradient for ID: "+e+"! "+o)}}function addBorderFill(e,t,a,i=-90){let r=$("#"+e),o=Math.PI*(2*r.attr("r"));"rect"==r.prop("tagName")&&(o=2*r.attr("width")+2*r.attr("height"),i+=90);$(r.clone().attr("id","border_"+e).css({fill:"transparent",filter:"none","transform-box":"fill-box",transform:"rotate("+i+"deg)","transform-origin":"50% 50%",transition:"stroke-dashoffset 1s ease-in-out",strokeDashoffset:o,strokeDasharray:o,strokeLinecap:a,"pointer-events":"none"})).insertAfter(r),r.css({stroke:t})}function updateBorderFill(e,t,a,i="cw"){try{let r=$("#border_"+e),o=$("#"+e).data("border_max"),s,l=r.attr("r"),n=Math.PI*(2*l);switch("rect"==r.prop("tagName")&&(n=2*r.attr("width")+2*r.attr("height")),a){case"percent":s=100-t;break;case"value":if(!o)throw Error("No max value for element declared!");s=100-t/o*100}s<0&&(s=0),s>100&&(s=100),n="cw"==i?n:-1*n;let c=s/100*n;r.css({strokeDashoffset:c,strokeDasharray:n})}catch(d){console.error("Error while updating border fill for ID: "+e+"! "+d)}}function refreshData(e){try{if(Object.entries(e.values).forEach(t=>{let[a,i]=t,r=void 0!=e.prepend[a]?e.prepend[a]:"";r+=i,r+=void 0!=e.append[a]?e.append[a]:"",r+=" "+e.unit[a],$("#"+a).html(r)}),displayMode){try{Object.entries(e.fillValues).forEach(e=>{let[t,a]=e,i=$("#"+t).data("fill_type"),r=$("#"+t).data("fill_direction");-1!=i&&($("#gradient_"+t).length>0||(addGradient(t,$("#"+t).data("fill_value"),r),console.log("Fill-Gradient added for: "+t)),updateGradient(t,a,i))})}catch(t){console.error("Could not apply Fill-Values. The following error was thrown: "+t)}try{Object.entries(e.borderValues).forEach(e=>{let[t,a]=e,i=$("#"+t).data("border_type"),r=$("#"+t).data("border_direction"),o=$("#"+t).data("border_style"),s=$("#"+t).data("border_start");-1!=i&&($("#border_"+t).length>0||(addBorderFill(t,$("#"+t).data("border_value"),o,s),console.log("Border-Fill added for: "+t)),updateBorderFill(t,a,i,r))})}catch(a){console.error("Could not apply Border-Values. The following error was thrown: "+a)}}try{Object.entries(e.animations).forEach(t=>{let[a,i]=t,r="",o="",s="";displayMode&&(e.animationProperties.hasOwnProperty(a)&&("dots"==e.animationProperties[a].type&&(r=e.animationProperties[a].stroke),"duration"==e.animationProperties[a].type&&(o=e.animationProperties[a].duration),"reverse"==e.animationProperties[a].option&&(s="reverse")),$("#"+a).css({display:i?"inline":"none","stroke-dasharray":r,"animation-duration":o+"ms","animation-direction":s}))})}catch(i){console.error("Could not apply Animations. The following error was thrown: "+i)}if(displayMode)try{e.hasOwnProperty("css")&&JSON.stringify(e.css)!=JSON.stringify(globalTmpCSS)&&(Object.entries(e.css).forEach(e=>{let[t,a]=e;a.inactPos&&$("#"+t).removeClass(a.inactPos),a.inactNeg&&$("#"+t).removeClass(a.inactNeg),a.actPos&&$("#"+t).addClass(a.actPos),a.actNeg&&$("#"+t).addClass(a.actNeg)}),globalTmpCSS=e.css)}catch(r){console.error("Could not apply Own CSS-Values. The following error was thrown: "+r)}}catch(o){console.error("An error accured, while refreshing the data! The following Error was thrown: "+o)}}async function translateGoogle(e,t){try{$.ajax({minLength:1,url:"http://translate.googleapis.com/translate_a/single?client=gtx&sl=en&dt=t",type:"GET",data:{tl:t,q:e},success:function(e){console.log(e[0][0][0])},error:function(){console.log("Error while translating into "+t)},timeout:3e3})}catch(a){console.log("Error!")}}function loadConfig(){if(console.log("Loading config for instance: "+instance),localMode){if(getBackups("backup_list"),configuration=localTest)console.log("Loading Local Config!"),setLoadedConfig();else{let e;e=displayMode?translateWord("failmsg_no_config_display_mode"):translateWord("failmsg_no_config"),basicConfig=!0,failedMessage(e),console.log(e)}}else socket.emit("getStates",objID,function(e,t){if(e)console.log(e),failedMessage(translateWord("failmsg_receiving_data"));else if(t){if(null!=t[objID[0]])try{backup_configuration=configuration=JSON.parse(t[objID[0]].val),getBackups("backup_list"),setLoadedConfig()}catch(a){let i;i=displayMode?translateWord("failmsg_no_config_display_mode"):translateWord("failmsg_no_config"),console.log("Error: "+a),basicConfig=!0,failedMessage(i),console.log("Applying basic configuration!"),$.getJSON("js/basic_config.json",function(e){(configuration=e)?setLoadedConfig():failedMessage(translateWord("failmsg_failed_config"))})}else failedMessage(translateWord("failmsg_instance").replace("${instance}","<b>"+instance+"</b>"));if(null!=t[objID[1]])try{if(console.log("Loading initial Data."),t[objID[1]].val)refreshData(JSON.parse(t[objID[1]].val));else throw Error("No data to display found! Please check, if layout is configured and saved properly!")}catch(r){console.log("An error occured, while loading data! "+r)}globalAdapterOnline=null!=t[objID[2]]&&t[objID[2]].val}else failedMessage(translateWord("failmsg_no_values"))})}const generateStateTree=async(e,t)=>{let a=document,i=a.createElement("ul");for(var r in i.className="tree-main",i.setAttribute("id","MainStateList"),$("#"+t).append(i),e){let o=r.split("."),s="",l="";for(let n=0;n<o.length;n++)if(l=s,n>0?s=s+"."+o[n]:s+=o[n],!document.getElementById(s)){let c=a.createElement("ul");c.className="childs";let d=a.createElement("li");var h=a.createElement("div"),g=a.createElement("span"),p=a.createElement("span"),u=a.createElement("span"),m=a.createElement("span"),v=a.createElement("span");if(n==o.length-1?(h.className="state",h.setAttribute("id",s),d.className="state_tree",p.className="type file",m.innerHTML=e[r].common.role||"",v.innerHTML=e[r].common.type||"",u.innerHTML=e[r].type,iobArray.push(s)):(d.setAttribute("id",s),d.className="maintree",p.className="type tree folderClosed",m.innerHTML="",v.innerHTML="",u.innerHTML="Folder"),g.innerHTML=o[n],h.append(p,g,u,m,v),d.append(h),0==n)a.getElementById("MainStateList").append(d);else{let f;try{f=a.getElementById(l).childNodes[1]}catch(b){}if(void 0!=f)"ul"==f.tagName.toLowerCase()&&f.append(d);else{c.append(d);try{a.getElementById(l).append(c)}catch(y){}}}}}$(".maintree div").click(function(){$(this).children("span.type.tree").toggleClass("folderOpen folderClosed"),$(this).siblings("ul").first().slideToggle("fast")}),$(".state_tree .state").click(function(){$(".state").removeClass("active"),$(".state").children(".type").removeClass("file-selected"),$(this).toggleClass("active"),$(this).children(".type").addClass("file-selected"),console.log("Active state: "+$(this).attr("id")),$("#select_state").prop("disabled",!1)}),console.log("Done!"),$("#stateExplorer_placeholder").hide()};function openStateTree(e,t=""){$("#select_state").prop("disabled",!0),$("#"+e).scrollTop(0);let a=$("[id^='"+t+"']").first();$(".childs").hide(),$(".state").removeClass("active"),$(".type").removeClass("file-selected"),$("span.tree").removeClass("folderOpen").addClass("folderClosed"),a.length&&($("#select_state").prop("disabled",!1),a.addClass("active"),a.children(".type").addClass("file-selected"),a.parents(".childs").slideToggle("fast"),a.parents(".maintree").children("div").find("span.tree").toggleClass("folderOpen folderClosed"),$("#"+e).animate({scrollTop:a.offset().top-180}))}function getElements(e,t){$("#"+e).empty();let a={},i=[],r=[],o=[],s=[],l=[],n=[],c=[],d=[],h;$(".added_elements, .type_line").each(function(){if($(this).hasClass("type_text")&&i.push({id:this.id,text:$(this).text()+" (ID: "+this.id+")"}),$(this).hasClass("type_datasource")){let e=$(this).data("source"),t=$('.data-table tbody tr[data-id="'+e+'"]').find("td:eq(0)",this).text();r.push({id:this.id,text:$(this).text()+" ("+t+")"})}if($(this).hasClass("type_circle")&&o.push({id:this.id,text:"ID "+this.id+" (X: "+$(this).attr("cx")+" Y: "+$(this).attr("cy")+")",y:$(this).attr("cy")}),$(this).hasClass("type_rect")&&s.push({id:this.id,text:"ID "+this.id+" (X: "+$(this).attr("x")+" Y: "+$(this).attr("y")+")",y:$(this).attr("y")}),$(this).hasClass("type_icon")&&l.push({id:this.id,text:"ID "+this.id+" (X: "+$(this).attr("x")+" Y: "+$(this).attr("y")+" - "+$(this).data("icon")+")",y:$(this).attr("y")}),$(this).hasClass("type_svg")&&c.push({id:this.id,text:"ID "+this.id+" (X: "+$(this).attr("x")+" Y: "+$(this).attr("y")+")",y:$(this).attr("y")}),$(this).hasClass("type_image")&&d.push({id:this.id,text:"ID "+this.id+" (X: "+$(this).attr("x")+" Y: "+$(this).attr("y")+")",y:$(this).attr("y")}),$(this).hasClass("type_line")){let a=$("#"+this.id.replace("line_","")).attr("d");a=a.substring(1,a.indexOf(" ")),n.push({id:this.id,text:"ID "+this.id+" (X: "+a+")",d:a})}}),i.sort((e,t)=>e.text<t.text?-1:e.text>t.text?1:0),a={opt_elm_circle:o.sort((e,t)=>parseFloat(e.y)-parseFloat(t.y)),opt_elm_ds:r.sort((e,t)=>parseFloat(e.id)-parseFloat(t.id)),opt_elm_icons:l.sort((e,t)=>parseFloat(e.y)-parseFloat(t.y)),opt_elm_svg:c.sort((e,t)=>parseFloat(e.y)-parseFloat(t.y)),opt_elm_image:d.sort((e,t)=>parseFloat(e.y)-parseFloat(t.y)),opt_elm_lines:n.sort((e,t)=>parseFloat(e.d)-parseFloat(t.d)),opt_elm_rect:s.sort((e,t)=>parseFloat(e.y)-parseFloat(t.y)),opt_elm_text:i},$.each(a,function(a,i){let r=$('<optgroup label="'+translateWord(a)+'" />');$.each(i,function(){(h=new Option(this.text,this.id)).selected=this.id==t,$(r).append(h)}),$("#"+e).append(r)})}function getDataSources(e,t,a=!0){a?$("#"+e).empty().append(new Option(translateWord("opt_please_choose"),"-1")):$("#"+e).empty();let i;$(".data-table tbody tr").each(function(){if(-1==$(this).data("id"))(i=new Option(translateWord("no_ds_added"),"-1")).disabled=!0,i.title=translateWord("ex_no_ds_added");else if(i=new Option($("td:eq(0)",this).text()+" ("+$("td:eq(1)",this).text()+")",$(this).data("id")),"object"==typeof t)for(var a in t)t[a]==$(this).data("id")&&(i.selected=!0);else i.selected=$(this).data("id")==t;$("#"+e).append(i)})}function setLoadedConfig(e=!1){if($("#svg_width_slider").val(configuration.basic.width),$("#svg_height_slider").val(configuration.basic.height),$("#svg_width_value").val(configuration.basic.width).trigger("change"),$("#svg_height_value").val(configuration.basic.height).trigger("change"),$("#enable_animation").prop("checked",configuration.basic.enable_animation).trigger("change"),$("#enable_grid").prop("checked",configuration.basic.enable_grid).trigger("change"),$("#enable_area_catch").prop("checked",configuration.basic.enable_area_catch).trigger("change"),$("#enable_config_icon").prop("checked",configuration.basic.enable_config_icon).trigger("change"),$("#enable_last_id").prop("checked",configuration.basic.enable_last_id).trigger("change"),$("#enable_proxy").prop("checked",configuration.basic.enable_icon_proxy).trigger("change"),$("#line_size").val(configuration.line.stroke_width),$("#animation_width").val(configuration.animation.stroke_width),$("#animation_duration").val(configuration.animation.animation_duration),$("#animation_type").val(configuration.animation.animation_timing_function),$("#animation_linecap").val(configuration.animation.stroke_linecap),$("#animation_dots").val(configuration.animation_configuration.dots),$("#animation_distance").val(configuration.animation_configuration.distance),$("#animation_length").val(configuration.animation_configuration.length),configuration.basic.rect?($("#basic_rect_height").val(configuration.basic.rect.height),$("#basic_rect_width").val(configuration.basic.rect.width),$("#basic_rect_corners").val(configuration.basic.rect.corners)):($("#basic_rect_height").val(100),$("#basic_rect_width").val(100),$("#basic_rect_corners").val(10),configuration.basic.rect={height:100,width:100,corners:10}),configuration.basic.font?($("#basic_font_family").val(configuration.basic.font.family),$("#basic_font_size").val(configuration.basic.font.size),displayMode||($("#basic_font_fill")[0].jscolor.fromString(configuration.basic.font.fill?configuration.basic.font.fill:""),$("#basic_font_color")[0].jscolor.fromString(configuration.basic.font.color?configuration.basic.font.color:"")),$("#basic_font_align").val(configuration.basic.font.align||"middle")):($("#basic_font_family").val('"Arial", sans-serif'),$("#basic_font_size").val(20),configuration.basic.font={family:'"Arial", sans-serif',size:20}),configuration.basic.circle?$("#basic_circle_radius").val(configuration.basic.circle.radius):($("#basic_circle_radius").val(50),configuration.basic.circle={radius:50}),configuration.basic.elm?($("#basic_stroke_width").val(configuration.basic.elm.stroke_width),$("#basic_pos_x").val(configuration.basic.elm.pos_x),$("#basic_pos_y").val(configuration.basic.elm.pos_y),displayMode||($("#basic_elm_fill")[0].jscolor.fromString(configuration.basic.elm.fill?configuration.basic.elm.fill:""),$("#basic_elm_color")[0].jscolor.fromString(configuration.basic.elm.color?configuration.basic.elm.color:""))):($("#basic_stroke_width").val(5),$("#basic_pos_x").val(50),$("#basic_pos_y").val(50),configuration.basic.elm={stroke_width:5,pos_x:50,pos_y:50}),configuration.basic.icon?($("#basic_icon_height").val(configuration.basic.icon.height),$("#basic_icon_width").val(configuration.basic.icon.width),displayMode||$("#basic_icon_color")[0].jscolor.fromString(configuration.basic.icon.color?configuration.basic.icon.color:"")):($("#basic_icon_height").val(24),$("#basic_icon_width").val(24),configuration.basic.icon={width:24,height:24}),updateLineAnimation(),$("#style_user").empty().append(configuration.basic.styles),$("#own_css").length>0&&$("#own_css").val(configuration.basic.styles),configuration.hasOwnProperty("datasources")){for(var t of Object.keys(configuration.datasources)){let a=configuration.datasources[t];a&&addDataSourceRow(t,a.source,a.alias)}$(".data-table th:eq(0)").click()}if(configuration.hasOwnProperty("calculation")&&(-1!=configuration.calculation.battery.charge&&getDataSources("calc_battery_charge",configuration.calculation.battery.charge,!0),-1!=configuration.calculation.battery.discharge&&getDataSources("calc_battery_discharge",configuration.calculation.battery.discharge,!0),-1!=configuration.calculation.battery.percent&&getDataSources("calc_battery_percent",configuration.calculation.battery.percent,!0),$("#calc_battery_dod").val(configuration.calculation.battery.dod),$("#calc_battery_capacity").val(configuration.calculation.battery.capacity),$("#calc_battery_discharge_kw").prop("checked",configuration.calculation.battery.discharge_kw),$("#calc_battery_discharge_prop").prop("checked",configuration.calculation.battery.discharge_prop),$("#calc_battery_charge_kw").prop("checked",configuration.calculation.battery.charge_kw),$("#calc_battery_charge_prop").prop("checked",configuration.calculation.battery.charge_prop),configuration.calculation.hasOwnProperty("consumption")&&(-1!=configuration.calculation.consumption.production&&getDataSources("calc_consumption_production",configuration.calculation.consumption.production,!0),-1!=configuration.calculation.consumption.gridFeed&&getDataSources("calc_consumption_gridFeed",configuration.calculation.consumption.gridFeed,!0),-1!=configuration.calculation.consumption.gridConsume&&getDataSources("calc_consumption_gridConsume",configuration.calculation.consumption.gridConsume,!0),-1!=configuration.calculation.consumption.batteryCharge&&getDataSources("calc_consumption_batteryCharge",configuration.calculation.consumption.batteryCharge,!0),-1!=configuration.calculation.consumption.batteryDischarge&&getDataSources("calc_consumption_batteryDischarge",configuration.calculation.consumption.batteryDischarge,!0),$("#calc_consumption_production_kw").prop("checked",configuration.calculation.consumption.production_kw),$("#calc_consumption_gridFeed_kw").prop("checked",configuration.calculation.consumption.gridFeed_kw),$("#calc_consumption_gridFeed_prop").prop("checked",configuration.calculation.consumption.gridFeed_prop),$("#calc_consumption_gridConsume_kw").prop("checked",configuration.calculation.consumption.gridConsume_kw),$("#calc_consumption_gridConsume_prop").prop("checked",configuration.calculation.consumption.gridConsume_prop),$("#calc_consumption_batteryCharge_kw").prop("checked",configuration.calculation.consumption.batteryCharge_kw),$("#calc_consumption_batteryCharge_prop").prop("checked",configuration.calculation.consumption.batteryCharge_prop),$("#calc_consumption_batteryDischarge_kw").prop("checked",configuration.calculation.consumption.batteryDischarge_kw),$("#calc_consumption_batteryDischarge_prop").prop("checked",configuration.calculation.consumption.batteryDischarge_prop))),configuration.hasOwnProperty("elements")){$(".placeholders").empty(),console.log("Loading User Config ...");let i=[];for(var t in configuration.elements)i.push({key:t,position:configuration.elements[t].position||-1});i.sort(function(e,t){return e.position-t.position});for(var r=0;r<i.length;r++){let o=configuration.elements[i[r].key];addElement({href:o.href,format:o.type,subType:o.subType,id:o.id,radius:o.radius,width:o.width,height:o.height,rx:o.rx,stroke:o.stroke,pos_x:o.pos_x,pos_y:o.pos_y,color:o.color,fill:o.fill,align:o.align||"middle",icon:o.icon,connPoint1:o.startSlot,connPoint2:o.endSlot,text:o.text,font_size:o.font_size,font_family:o.font_family,unit:o.unit,append:o.append||"",prepend:o.prepend||"",source:o.source>=0?o.source:-1,source_option:o.source_option||-1,source_display:o.source_display||"value",degree:o.degree,shadow:o.shadow,threshold:o.threshold||0,convert:o.convert||!1,calculate_kw:o.calculate_kw||!1,decimal_places:o.decimal_places||0,url:o.url||"",frame:o.frame||"_overlay",fill_value:o.fill_value||"",fill_type:o.fill_type||-1,fill_direction:o.fill_direction||90,fill_max:o.fill_max||"",border_value:o.border_value||"",border_type:o.border_type||-1,border_direction:o.border_direction||"cw",border_style:o.border_style||"round",border_max:o.border_max||"",border_reverse_value:o.border_reverse_value||"",border_reverse:o.border_reverse||!1,border_start:o.border_start||180,subtract:o.subtract||"[-1]",css_general:o.css_general||"",css_active_positive:o.css_active_positive||"",css_inactive_positive:o.css_inactive_positive||"",css_active_negative:o.css_active_negative||"",css_inactive_negative:o.css_inactive_negative||"",action:o.action||"none"})}Object.entries(configuration.defs).forEach(e=>{let[t,a]=e;addElement({format:a.type,id:a.id,connPoint1:a.startSlot,connPoint2:a.endSlot,d:a.d})}),Object.entries(configuration.lines).forEach(e=>{let[t,a]=e;addElement({format:a.type,id:a.id,href:a.href,color:a.color,shadow:a.shadow})}),Object.entries(configuration.animations).forEach(e=>{let[t,a]=e;addElement({format:a.type,id:a.id,href:a.href,color:a.color,source:a.source,animation_properties:a.animation_properties||"positive",animation_option:a.animation_option||!1,threshold:a.threshold||0,dots:a.dots||0,duration:a.duration||0,power:a.power||0,animation_type:a.animation_type||-1,css_general:a.css_general||"",css_active_positive:a.css_active_positive||"",css_inactive_positive:a.css_inactive_positive||"",css_active_negative:a.css_active_negative||"",css_inactive_negative:a.css_inactive_negative||""})}),socket.emit("getObject","system.adapter."+adapterNameNamespace,function(e,t){!e&&t&&t.native&&(globalIconProxy=t.native.enable_proxy,globalIconProxyPort=t.native.proxy_port,globalIconProxy?($("#enable_proxy").prop("disabled",!1),$("label[for='enable_proxy']").attr("title",""),!0==configuration.basic.enable_icon_proxy?(console.log("Using Icon-Proxy for Icons!"),startIconObserver(),$(".iconify").each(function(){loadIconViaProxy($(this).data("icon"),$(this))})):(console.log("Using direct load via iconify-API!"),loadAdditionalJSFile("js/iconify.min.js"))):$("#enable_proxy").prop("checked",!1).trigger("change"))}),displayMode&&($("#svg_display").attr({viewBox:"0 0 "+configuration.basic.width+" "+configuration.basic.height}),$(".all_elements").removeClass("draggable draggable-group anim_element no_animation"),$("#style_general").empty().append(".line { cursor: none; pointer-events: none; } .all_elements:hover { opacity: unset; }"),$(".type_animation").addClass("animation"),$("#config_link > a").attr("href","configuration.html?instance="+instance),!1==configuration.basic.enable_config_icon?$("#config_link").hide():$("#config_link").show(),$(".type_datasource").html("").attr("title",""),$("#overlay_frame").on("load",function(){""!=$(this).attr("src")&&($(".loading-spinner, #loading_text").fadeOut("fast"),$("#display_container").fadeIn("middle").css("display","block"))}),e?console.log("Applying config without re-adding socket listener!"):displayListener()),basicConfig||displayMode||successMessage(translateWord("succ_msg_loading")),$("#loading").fadeOut("fast")}else successMessage(translateWord("succ_msg_loading_basic")),$("#loading").fadeOut("fast")}function updateLineAnimation(){$("#style_animation").empty().append(".line {stroke-width:"+configuration.line.stroke_width+"px; stroke:"+configuration.line.stroke+";}").append(".animation {stroke:"+configuration.animation.stroke+"; stroke-dasharray:"+configuration.animation.stroke_dasharray+";").append("stroke-width:"+configuration.animation.stroke_width+"px; animation-duration:"+configuration.animation.animation_duration+"ms;").append("stroke-linecap:"+configuration.animation.stroke_linecap+"; animation-timing-function:"+configuration.animation.animation_timing_function+";}"),displayMode&&$("#style_animation").append(".type_animation {display: none;}")}function linePreview(e){let t="",a=136,i=parseInt($("#animation_width").val()),r=parseInt($("#animation_dots").val()),o=parseInt($("#animation_distance").val()),s=parseInt($("#animation_length").val()),l=parseInt($("#line_size").val()),n=parseInt($("#animation_duration").val()),c=$("#animation_linecap").val(),d=$("#animation_type").val();for(let h=0;h<r;h++)o>0&&s>0&&(t+=s+" ",h!=r-1&&(t+=o+" ",a-=o),a-=s);r>0&&s>0&&o&&(t+=" "+a),a<0&&$("#"+e).val($("#"+e).val()-1),configuration.animation.stroke_dasharray=t,configuration.animation.stroke_width=i,configuration.animation.animation_duration=n,configuration.animation.stroke_linecap=c,configuration.animation.animation_timing_function=d,configuration.line.stroke_width=l,configuration.animation_configuration.dots=r,configuration.animation_configuration.distance=o,configuration.animation_configuration.length=s,updateLineAnimation()}function successMessage(e){$("#message_success").html(e),$("#message_success").fadeIn("middle").delay(2e3).fadeOut("middle")}function failedMessage(e){$("#message_failed").html(e),$("#message_failed").fadeIn("middle").delay(2e3).fadeOut("middle")}function getRotationDegrees(e){var t=e.css("-webkit-transform")||e.css("-moz-transform")||e.css("-ms-transform")||e.css("-o-transform")||e.css("transform");if("none"!==t)var a=t.split("(")[1].split(")")[0].split(","),i=a[0],r=Math.round(Math.atan2(a[1],i)*(180/Math.PI));else var r=0;return r}function resizeSVG(){$("#svg_config").attr({width:$("#svg_width_value").val(),height:$("#svg_height_value").val(),viewBox:"0 0 "+$("#svg_width_value").val()+" "+$("#svg_height_value").val()})}function getCoords(e){let t,a,i,r,o,s,l,n,c;return i=null!=$(e="#"+e).attr("r")?parseInt($(e).attr("r")):0,t=null!=$(e).attr("x")?parseInt($(e).attr("x")):parseInt($(e).attr("cx"))-i,a=null!=$(e).attr("y")?parseInt($(e).attr("y")):parseInt($(e).attr("cy"))-i,n=null!=$(e).attr("cx")?parseInt($(e).attr("cx")):0,c=null!=$(e).attr("cy")?parseInt($(e).attr("cy")):0,r=null!=$(e).attr("width")?parseInt($(e).attr("width")):2*i,o=null!=$(e).attr("height")?parseInt($(e).attr("height")):2*i,s=parseInt($(e).css("stroke-width")),"text"===$(e).prop("tagName")&&(r=Math.round(document.getElementById(e.replace("#","")).getComputedTextLength()),o=parseInt($(e).css("font-size")),t=Math.round(t-Math.floor(r/2)),a=Math.round(a-Math.floor(o/2))),{x:t,y:a,cx:n,cy:c,width:r,height:o,r:i,stroke:s,slot:l}}function showConnectionPoints(e=!0){e?($("#connection_points").empty(),$(".connector").each(function(){let e=$(this).attr("id"),t={};t[e]={};let a=$(this).prop("tagName"),i,r,o,s,l,n,c;switch(a){case"circle":i=parseInt(2*$(this).attr("r")),r=parseInt(2*$(this).attr("r")),o=parseInt($(this).attr("cx")-r/2),s=parseInt($(this).attr("cy")-i/2),l=parseInt($(this).attr("r")),n=parseInt($(this).attr("cx")),c=parseInt($(this).attr("cy")),t[e].top_left={x:n+l*Math.cos(connectorAngle(340)),y:c+l*Math.sin(connectorAngle(340))},t[e].top_right={x:n+l*Math.cos(connectorAngle(20)),y:c+l*Math.sin(connectorAngle(20))},t[e].right_top={x:n+l*Math.cos(connectorAngle(70)),y:c+l*Math.sin(connectorAngle(70))},t[e].right_bottom={x:n+l*Math.cos(connectorAngle(110)),y:c+l*Math.sin(connectorAngle(110))},t[e].bottom_left={x:n+l*Math.cos(connectorAngle(200)),y:c+l*Math.sin(connectorAngle(200))},t[e].bottom_right={x:n+l*Math.cos(connectorAngle(160)),y:c+l*Math.sin(connectorAngle(160))},t[e].left_bottom={x:n+l*Math.cos(connectorAngle(250)),y:c+l*Math.sin(connectorAngle(250))},t[e].left_top={x:n+l*Math.cos(connectorAngle(290)),y:c+l*Math.sin(connectorAngle(290))};break;case"rect":i=parseInt($(this).attr("height")),r=parseInt($(this).attr("width")),o=parseInt($(this).attr("x")),s=parseInt($(this).attr("y")),t[e].top_left={x:o+r/2-20,y:s},t[e].top_right={x:o+r/2+20,y:s},t[e].left_top={x:o,y:s+i/2-20},t[e].left_bottom={x:o,y:s+i/2+20},t[e].right_top={x:o+r,y:s+i/2-20},t[e].right_bottom={x:o+r,y:s+i/2+20},t[e].bottom_left={x:o+r/2-20,y:s+i},t[e].bottom_right={x:o+r/2+20,y:s+i}}t[e].top={x:o+r/2,y:s},t[e].left={x:o,y:s+i/2},t[e].right={x:o+r,y:s+i/2},t[e].bottom={x:o+r/2,y:s+i},Object.entries(t).forEach(t=>{let[a,i]=t;Object.entries(i).forEach(t=>{let[a,i]=t,r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("class","tmp_conn_points"),r.setAttribute("cx",i.x),r.setAttribute("cy",i.y),r.setAttribute("r",5),r.setAttribute("class","connPoints clickable"),r.setAttribute("data-slot",a),r.setAttribute("data-element",e),$(r).appendTo("#connection_points")})})})):$("#connection_points").empty()}function getSlots(e){let t={},a={},i={},r={};return t.x=e.x+Math.floor(e.width/2),t.y=e.y-Math.floor(e.stroke/2),t.direction="vertical",a.x=e.x+e.width+Math.floor(e.stroke/2),a.y=e.y+Math.floor(e.height/2),a.direction="horizontal",i.x=e.x+e.width/2,i.y=e.y+e.height+Math.floor(e.stroke/2),i.direction="vertical",r.x=e.x-Math.floor(e.stroke/2),r.y=e.y+Math.floor(e.height/2),r.direction="horizontal",{top:t,right:a,bottom:i,left:r}}function connectorAngle(e){return(e-90)*Math.PI/180}function getSpecialSlots(e,t){let a=[];return a.top={x:e.x+e.width/2,y:e.y-e.stroke/2,direction:"vertical"},a.left={x:e.x-e.stroke/2,y:e.y+e.height/2,direction:"horizontal"},a.right={x:e.x+e.width+e.stroke/2,y:e.y+e.height/2,direction:"horizontal"},a.bottom={x:e.x+e.width/2,y:e.y+e.height+e.stroke/2,direction:"vertical"},e.r>0?(a.top_left={x:e.cx+e.r*Math.cos(connectorAngle(340)),y:e.cy+e.r*Math.sin(connectorAngle(340))-e.stroke/2,direction:"vertical"},a.top_right={x:e.cx+e.r*Math.cos(connectorAngle(20)),y:e.cy+e.r*Math.sin(connectorAngle(20))-e.stroke/2,direction:"vertical"},a.right_top={x:e.cx+e.r*Math.cos(connectorAngle(70))+e.stroke/2,y:e.cy+e.r*Math.sin(connectorAngle(70)),direction:"horizontal"},a.right_bottom={x:e.cx+e.r*Math.cos(connectorAngle(110))+e.stroke/2,y:e.cy+e.r*Math.sin(connectorAngle(110)),direction:"horizontal"},a.bottom_left={x:e.cx+e.r*Math.cos(connectorAngle(200)),y:e.cy+e.r*Math.sin(connectorAngle(200))+e.stroke/2,direction:"vertical"},a.bottom_right={x:e.cx+e.r*Math.cos(connectorAngle(160)),y:e.cy+e.r*Math.sin(connectorAngle(160))+e.stroke/2,direction:"vertical"},a.left_bottom={x:e.cx+e.r*Math.cos(connectorAngle(250))-e.stroke/2,y:e.cy+e.r*Math.sin(connectorAngle(250)),direction:"horizontal"},a.left_top={x:e.cx+e.r*Math.cos(connectorAngle(290))-e.stroke/2,y:e.cy+e.r*Math.sin(connectorAngle(290)),direction:"horizontal"}):(a.top_left={x:e.x+e.width/2-20,y:e.y-e.stroke/2,direction:"vertical"},a.top_right={x:e.x+e.width/2+20,y:e.y-e.stroke/2,direction:"vertical"},a.right_top={x:e.x+e.width+e.stroke/2,y:e.y+e.height/2-20,direction:"horizontal"},a.right_bottom={x:e.x+e.width+e.stroke/2,y:e.y+e.height/2+20,direction:"horizontal"},a.bottom_left={x:e.x+e.width/2-20,y:e.y+e.height+e.stroke/2,direction:"vertical"},a.bottom_right={x:e.x+e.width/2+20,y:e.y+e.height+e.stroke/2,direction:"vertical"},a.left_top={x:e.x-e.stroke/2,y:e.y+e.height/2-20,direction:"horizontal"},a.left_bottom={x:e.x-e.stroke/2,y:e.y+e.height/2+20,direction:"horizontal"}),{spec:a[t]}}function reverseObject(e){let t={};return Object.keys(e).reverse().forEach(function(a){t[a]=e[a]}),t}function getDistance(e,t){let a=0,i=0;return a=t.x>e.x?t.x-e.x:e.x-t.x,a*=a,i=t.y>e.y?t.y-e.y:e.y-t.y,Math.sqrt(a+(i*=i))}function connectElements(e,t,a){let i=getCoords(t),r=getCoords(a),o,s,l,n;o=$("#"+e).data("start-slot"),s=$("#"+e).data("end-slot");let c=[],d=[],h=[],g=[],p=[],u=[],m=[];for(var v of(l="element"!=o?getSpecialSlots(i,o):getSlots(i),n="element"!=s?getSpecialSlots(r,s):getSlots(r),Object.keys(l))){let f=l[v];for(var v of Object.keys(n)){let b=n[v];c.push(getDistance(f,b)),d.push(f.x),g.push(f.y),u.push(f.direction),h.push(b.x),p.push(b.y),m.push(b.direction)}}let y=c[0],x=0;for(var w=1;w<c.length;w++)c[w]<y&&(y=c[w],x=w);let k=d[x],_=g[x],A;drawPath(e,k,_,h[x],p[x],u[x],m[x])}function polarToCartesian(e,t,a,i){var r=(i-90)*Math.PI/180;return{x:e+a*Math.cos(r),y:t+a*Math.sin(r)}}function describeArc(e,t,a,i,r,o){var s=polarToCartesian(e,t,a,r);return polarToCartesian(e,t,a,i),["A",a,a,0,r-i<=180?"0":"1",o,s.x,s.y]}function drawPath(e,t,a,i,r,o,s,l){let n={x:0,y:0},c=[],d=t>i?t-i:i-t,h=a>r?a-r:r-a,g=15;d<2*g&&(g=Math.floor(d/2)),h<2*g&&(g=Math.floor(h/2));let p=i>t?parseInt(i-t):parseInt(t-i),u=parseInt(r-a);c[0]="M"+t+" "+a,n={x:t,y:a};let m;if(i>t){let v=t+.2*p;c[1]=" H "+v,n.x=v}if(i<t){let f=t-.2*p;c[1]=" H "+f,n.x=f}if(r==a&&(c[1]=" H "+i),i===t&&(c[1]=" V "+r),i!=t&&r!=a){if(r>a&&i>t){m=describeArc(n.x,n.y+g,g,0,90,1);let b=r-g;if(n={x:m[6],y:m[7]},c[2]=m.join(" "),c[3]=" V "+b,n.y=b,m=describeArc(n.x,n.y+g,g,0,90,0),c[4]=m.join(" "),c[5]=" H "+i,"vertical"==o&&"vertical"==s){n={x:t,y:a};let y=a+.2*u;c[1]=" V "+y,n.y=y,m=describeArc(n.x,n.y+g,g,0,90,0),y=i-g,n={x:m[6],y:m[7]},c[2]=m.join(" "),c[3]=" H "+y,n.x=y,n={x:(m=describeArc(n.x,n.y+g,g,0,90,1))[6],y:m[7]},c[4]=m.join(" "),c[5]=" V "+r}if("horizontal"==o&&"vertical"==s){n={x:t,y:a};let x=t+.2*p;c[1]=" H "+x,n.x=x,x=i-g,c[2]="",c[3]=" H "+x,n.x=x,n={x:(m=describeArc(n.x,n.y+g,g,0,90,1))[6],y:m[7]},c[4]=m.join(" "),c[5]=" V "+r}if("vertical"==o&&"horizontal"==s){let w=a+.2*u;n={x:t,y:w},c[1]=" V "+w,w=r-g,n.y=w,c[2]="",c[3]=" V "+w,m=describeArc(n.x,n.y+g,g,0,90,0),c[4]=m.join(" "),c[5]=" H "+i}}if(r>a&&i<t){m=describeArc(n.x,n.y+g,g,180,270,0);let k=r-g;if(n={x:m[6],y:k},c[2]=m.join(" "),c[3]=" V "+k,m=describeArc(n.x,n.y+g,g,180,270,1),c[4]=m.join(" "),c[5]=" H "+i,"vertical"==o&&"vertical"==s){let _=a+.2*u;n={x:t,y:_},c[1]=" V "+_,m=describeArc(n.x-g,n.y,g,90,180,1),n={x:_=i+g,y:m[7]},c[2]=m.join(" "),c[3]=" H "+_,m=describeArc(n.x,n.y+g,g,180,270,0),c[4]=m.join(" "),c[5]=" V "+r}if("vertical"==o&&"horizontal"==s){let A=a+.2*u;n={x:t,y:A},c[1]=" V "+A,A=r-g,n.y=A,c[2]="",c[3]=" V "+A,m=describeArc(n.x,n.y+g,g,180,270,1),c[4]=m.join(" "),c[5]=" H "+i}if("horizontal"==o&&"vertical"==s){n={x:t,y:a};let C=t-.2*p;c[1]=" H "+C,n.x=C,C=i+g,c[2]="",c[3]=" H "+C,n.x=C,n={x:(m=describeArc(n.x,n.y+g,g,180,270,0))[6],y:m[7]},c[4]=m.join(" "),c[5]=" V "+r}}if(r<a&&i>t){m=describeArc(n.x,n.y-g,g,0,90,0);let S=r+g;if(n={x:m[6],y:S},c[2]=m.join(" "),c[3]=" V "+S,m=describeArc(n.x+g,n.y,g,270,360,1),c[4]=m.join(" "),c[5]=" H "+i,"vertical"==o&&"horizontal"==s){let E=a+.2*u;n={x:t,y:E},c[1]=" V "+E,E=r+g,n.y=E,c[2]="",c[3]=" V "+E,m=describeArc(n.x,n.y-g,g,0,90,1),c[4]=m.join(" "),c[5]=" H "+i}if("vertical"==o&&"vertical"==s){let L=a+.2*u;n={x:t,y:L},c[1]=" V "+L,m=describeArc(n.x,n.y-g,g,0,90,1),n={x:L=i-g,y:m[7]},c[2]=m.join(" "),c[3]=" H "+L,m=describeArc(n.x,n.y-g,g,0,90,0),c[4]=m.join(" "),c[5]=" V "+r}if("horizontal"==o&&"vertical"==s){n={x:t,y:a};let D=t+.2*p;c[1]=" H "+D,n.x=D,D=i-g,c[2]="",c[3]=" H "+D,n.x=D,n={x:(m=describeArc(n.x,n.y-g,g,0,90,0))[6],y:m[7]},c[4]=m.join(" "),c[5]=" V "+r}}if(r<a&&i<t){m=describeArc(n.x,n.y-g,g,180,270,1);let j=r+g;if(n={x:m[6],y:j},c[2]=m.join(" "),c[3]=" V "+j,m=describeArc(n.x-2*g,n.y-g,g,0,90,0),c[4]=m.join(" "),c[5]=" H "+i,"vertical"==o&&"horizontal"==s){let N=a+.2*u;n={x:t,y:N},c[1]=" V "+N,c[2]="",N=r+g,n.y=N,m=describeArc(n.x-2*g,n.y-g,g,0,90,0),c[4]=m.join(" "),c[5]=" H "+i}if("vertical"==o&&"vertical"==s){let I=a+.2*u;n={x:t,y:I},c[1]=" V "+I,m=describeArc(n.x-2*g,n.y-g,g,0,90,0),n={x:I=i+g,y:m[7]},c[2]=m.join(" "),c[3]=" H "+I,m=describeArc(n.x,n.y-g,g,180,270,1),c[4]=m.join(" "),c[5]="  V "+r}if("horizontal"==o&&"vertical"==s){n={x:t,y:a};let M=t-.2*p;c[1]=" H "+M,n.x=M,M=i+g,c[2]="",c[3]=" H "+M,n.x=M,n={x:(m=describeArc(n.x,n.y-g,g,180,270,1))[6],y:m[7]},c[4]=m.join(" "),c[5]=" V "+r}}}$("#"+e).attr("d",c.join(" "))}function getShadowColor(e){let t=$("#"+e).css("filter").replace("drop-shadow(","").split(" ");return"none"!=t[0]?t[0]+t[1]+t[2]+t[3]:""}function showConfigBar(e,t){$("#tab1_config").prop("checked",!0);let a=$("#"+e).data("type")?$("#"+e).data("type"):"";getElements("elm_select",e);let i,r=getShadowColor(i="use"==t?e.replace("anim","line"):e);switch($("#elm_shadow").prop("checked",""!=r),$("#elm_calculation").prop("checked",!1),$("#elm_convert").prop("checked",!1),restore={},$(".elm_config").attr("style",""),$(".all_elements").addClass("faded_out"),$("#"+e).removeClass("faded_out"),$(".elm_config").prop("disabled",!1),restore.id=$("#"+e).attr("id"),$(".elm_config_circle, .elm_config_text, .elm_config_rect, .elm_config_use, .elm_config_datasource, .elm_config_icon, .elm_config_svg, .anim_type_duration, .anim_type_dots, .fill_type, .border_type, .border_type_value, .fill_type_value, .border_reverse_value, .elm_config_image").hide(),restore.shadow_color=r,$("#elm_shadow_color")[0].jscolor.fromString(restore.shadow_color),restore.color="none"==$("#"+e).css("stroke")?"":$("#"+e).css("stroke"),$("#elm_color")[0].jscolor.fromString(restore.color),restore.css_general=$("#"+e).data("css_general"),$("#elm_css_general").val(restore.css_general),restore.css_active_positive=$("#"+e).data("css_active_positive"),$("#elm_css_active_positive").val(restore.css_active_positive),restore.css_inactive_positive=$("#"+e).data("css_inactive_positive"),$("#elm_css_inactive_positive").val(restore.css_inactive_positive),restore.css_active_negative=$("#"+e).data("css_active_negative"),$("#elm_css_active_negative").val(restore.css_active_negative),restore.css_inactive_negative=$("#"+e).data("css_inactive_negative"),$("#elm_css_inactive_negative").val(restore.css_inactive_negative),t){case"rect":$("#elm_border_value_fill")[0].jscolor.fromString(restore.color),$("#elm_border_value_fill").prop("disabled",!0),$(".elm_config_rect").show(),restore.width=$("#"+e).attr("width"),$("#elm_width").val(restore.width),restore.height=$("#"+e).attr("height"),$("#elm_height").val(restore.height),restore.pos_x=$("#"+e).attr("x"),$("#elm_pos_x").val(restore.pos_x),restore.pos_y=$("#"+e).attr("y"),$("#elm_pos_y").val(restore.pos_y),restore.rx=$("#"+e).attr("rx"),$("#elm_rx").val(restore.rx),restore.fill="none"==$("#"+e).css("fill")||$("#"+e).css("fill").includes("url")?"":$("#"+e).css("fill"),$("#elm_fill")[0].jscolor.fromString(restore.fill),restore.stroke=$("#"+e).css("stroke-width").replace("px",""),$("#elm_stroke").val(restore.stroke),restore.url=$("#"+e).data("url"),$("#elm_url").val(restore.url),restore.frame=$("#"+e).data("frame"),$("#elm_frame").val(restore.frame),restore.fill_value=""==$("#"+e).data("fill_value")?"":$("#"+e).data("fill_value"),$("#elm_fill_value")[0].jscolor.fromString(restore.fill_value),restore.fill_direction=$("#"+e).data("fill_direction"),$("#elm_fill_direction").val(restore.fill_direction),restore.fill_type=$("#"+e).data("fill_type"),$("#elm_fill_type").val(restore.fill_type),-1!=restore.fill_type&&($(".fill_type").show(),"value"==restore.fill_type?$(".fill_type_value").show():$(".fill_type_value").hide()),restore.fill_max=$("#"+e).data("fill_max"),$("#elm_fill_max").val(restore.fill_max),restore.border_value=""==$("#"+e).data("border_value")?"":$("#"+e).data("border_value"),$("#elm_border_value")[0].jscolor.fromString(restore.border_value),restore.border_direction=$("#"+e).data("border_direction"),$("#elm_border_direction").val(restore.border_direction),restore.border_style=$("#"+e).data("border_style"),$("#elm_border_style").val(restore.border_style),restore.border_start=$("#"+e).data("border_start"),$("#elm_border_start").val(restore.border_start),restore.border_type=$("#"+e).data("border_type"),$("#elm_border_type").val(restore.border_type),-1!=restore.border_type&&($(".border_type").show(),"value"==restore.border_type?$(".border_type_value").show():$(".border_type_value").hide()),restore.border_max=$("#"+e).data("border_max"),$("#elm_border_max").val(restore.border_max),restore.border_reverse_value=""==$("#"+e).data("border_reverse_value")?"":$("#"+e).data("border_reverse_value"),$("#elm_border_reverse_value")[0].jscolor.fromString(restore.border_reverse_value),restore.border_reverse=$("#"+e).data("border_reverse"),$("#elm_border_reverse").prop("checked",restore.border_reverse),restore.border_reverse&&$(".border_reverse_value").show(),restore.threshold=$("#"+e).data("threshold"),$("#elm_threshold").val(restore.threshold),restore.source=$("#"+e).data("source"),getDataSources("elm_source",restore.source);break;case"circle":$("#elm_border_value_fill")[0].jscolor.fromString(restore.color),$("#elm_border_value_fill").prop("disabled",!0),$(".elm_config_circle").show(),restore.radius=$("#"+e).attr("r"),$("#elm_radius").val(restore.radius),restore.pos_x=$("#"+e).attr("cx"),$("#elm_pos_x").val(restore.pos_x),restore.pos_y=$("#"+e).attr("cy"),$("#elm_pos_y").val(restore.pos_y),restore.fill="none"==$("#"+e).css("fill")||$("#"+e).css("fill").includes("url")?"":$("#"+e).css("fill"),$("#elm_fill")[0].jscolor.fromString(restore.fill),restore.stroke=$("#"+e).css("stroke-width").replace("px",""),$("#elm_stroke").val(restore.stroke),restore.url=$("#"+e).data("url"),$("#elm_url").val(restore.url),restore.frame=$("#"+e).data("frame"),$("#elm_frame").val(restore.frame),restore.fill_value=""==$("#"+e).data("fill_value")?"":$("#"+e).data("fill_value"),$("#elm_fill_value")[0].jscolor.fromString(restore.fill_value),restore.fill_type=$("#"+e).data("fill_type"),$("#elm_fill_type").val(restore.fill_type),restore.fill_direction=$("#"+e).data("fill_direction"),$("#elm_fill_direction").val(restore.fill_direction),-1!=restore.fill_type&&($(".fill_type").show(),"value"==restore.fill_type?$(".fill_type_value").show():$(".fill_type_value").hide()),restore.fill_max=$("#"+e).data("fill_max"),$("#elm_fill_max").val(restore.fill_max),restore.border_value=""==$("#"+e).data("border_value")?"":$("#"+e).data("border_value"),$("#elm_border_value")[0].jscolor.fromString(restore.border_value),restore.border_direction=$("#"+e).data("border_direction"),$("#elm_border_direction").val(restore.border_direction),restore.border_style=$("#"+e).data("border_style"),$("#elm_border_style").val(restore.border_style),restore.border_start=$("#"+e).data("border_start"),$("#elm_border_start").val(restore.border_start),restore.border_type=$("#"+e).data("border_type"),$("#elm_border_type").val(restore.border_type),-1!=restore.border_type&&($(".border_type").show(),"value"==restore.border_type?$(".border_type_value").show():$(".border_type_value").hide()),restore.border_max=$("#"+e).data("border_max"),$("#elm_border_max").val(restore.border_max),restore.border_reverse_value=""==$("#"+e).data("border_reverse_value")?"":$("#"+e).data("border_reverse_value"),$("#elm_border_reverse_value")[0].jscolor.fromString(restore.border_reverse_value),restore.border_reverse=$("#"+e).data("border_reverse"),$("#elm_border_reverse").prop("checked",restore.border_reverse),restore.border_reverse&&$(".border_reverse_value").show(),restore.threshold=$("#"+e).data("threshold"),$("#elm_threshold").val(restore.threshold),restore.source=$("#"+e).data("source"),getDataSources("elm_source",restore.source,!0);break;case"text":$(".elm_config_text").show(),$(".elm_config_text_not_ds").show(),"datasource"==a&&(restore.unit=$("#"+e).data("unit"),$("#elm_unit").val(restore.unit),restore.prepend=$("#"+e).data("prepend"),$("#elm_prepend").val(restore.prepend),restore.append=$("#"+e).data("append"),$("#elm_append").val(restore.append),restore.source=$("#"+e).data("source"),getDataSources("elm_source",restore.source,!0),restore.source_option=$("#"+e).data("source_option"),$("#elm_source_option").val(restore.source_option),restore.source_display=$("#"+e).data("source_display"),$("#elm_source_display").val(restore.source_display),restore.calculate_kw=$("#"+e).data("calculate_kw"),$("#elm_calculation").prop("checked",!0===restore.calculate_kw),restore.convert=$("#"+e).data("convert"),$("#elm_convert").prop("checked",!0===restore.convert),restore.threshold=$("#"+e).data("threshold"),$("#elm_threshold").val(restore.threshold),restore.decimal_places=$("#"+e).data("decimal_places"),$("#elm_decimal_places").val(restore.decimal_places),restore.action=$("#"+e).data("action"),$("#elm_action").val(restore.action),$(".elm_config_datasource").show(),$(".elm_config_text_not_ds").hide(),restore.subtract=$("#"+e).data("subtract"),getDataSources("elm_subtract",restore.subtract,!1),$("#elm_subtract").multiselect("unload"),$("#elm_subtract").multiselect(multiselect_options)),restore.url=$("#"+e).data("url"),$("#elm_url").val(restore.url),restore.frame=$("#"+e).data("frame"),$("#elm_frame").val(restore.frame),restore.pos_x=$("#"+e).attr("x"),$("#elm_pos_x").val(restore.pos_x),restore.pos_y=$("#"+e).attr("y"),$("#elm_pos_y").val(restore.pos_y),restore.fill="none"==$("#"+e).css("fill")?"":$("#"+e).css("fill"),$("#elm_fill")[0].jscolor.fromString(restore.fill),restore.text=$("#"+e).html(),$("#elm_text").val(restore.text),restore.align=$("#"+e).css("text-anchor"),$("#elm_align").val(restore.align),restore.font=$("#"+e).css("font-family"),$("#elm_font").val(restore.font),restore.degree=getRotationDegrees($("#"+e)),restore.font_size=$("#"+e).css("font-size").replace("px",""),$("#elm_font_size").val(restore.font_size);break;case"use":let o=e.replace("line","anim");restore.source=$("#"+o).data("source"),getDataSources("elm_animation",restore.source),restore.animation_properties=$("#"+o).data("animation_properties"),$("#elm_animation_properties").val(restore.animation_properties),restore.animation_option=$("#"+o).data("animation_option"),$("#elm_animation_option").prop("checked",restore.animation_option),restore.threshold=$("#"+o).data("threshold"),$("#elm_threshold").val(restore.threshold),$(".elm_config_use").show(),$("#"+e).removeClass("faded_out"),restore.color="none"==$("#"+o).css("stroke")?"":$("#"+o).css("stroke"),$("#elm_color")[0].jscolor.fromString(restore.color),restore.css_general=$("#"+o).data("css_general"),$("#elm_css_general").val(restore.css_general),restore.css_active_positive=$("#"+o).data("css_active_positive"),$("#elm_css_active_positive").val(restore.css_active_positive),restore.css_inactive_positive=$("#"+o).data("css_inactive_positive"),$("#elm_css_inactive_positive").val(restore.css_inactive_positive),restore.css_active_negative=$("#"+e).data("css_active_negative"),$("#elm_css_active_negative").val(restore.css_active_negative),restore.css_inactive_negative=$("#"+e).data("css_inactive_negative"),$("#elm_css_inactive_negative").val(restore.css_inactive_negative),restore.line_color=$("#"+e).css("stroke"),$("#elm_line_color")[0].jscolor.fromString(restore.line_color),restore.elm_dots=$("#"+o).data("dots"),$("#elm_dots").val(restore.elm_dots),restore.elm_duration=$("#"+o).data("duration"),$("#elm_duration").val(restore.elm_duration),restore.elm_power=$("#"+o).data("power"),$("#elm_power").val(restore.elm_power),restore.elm_animation_type=$("#"+o).data("animation_type"),$("#elm_animation_type").val(restore.elm_animation_type),$(".anim_type_"+restore.elm_animation_type).show(),restore.startSlot=$("#"+o.replace("anim_","")).data("start-slot"),restore.endSlot=$("#"+o.replace("anim_","")).data("end-slot");let s="",l="";s="element"==restore.startSlot?restore.startSlot+" (auto align)":restore.startSlot.replace("_"," "),l="element"==restore.endSlot?restore.endSlot+" (auto align)":restore.endSlot.replace("_"," "),$("#elm_start_slot").val(s),$("#elm_end_slot").val(l);break;case"svg":restore.width=$("#"+e).attr("width"),$("#elm_width").val(restore.width),restore.elm_height=$("#"+e).attr("height"),$("#elm_height").val(restore.elm_height),restore.pos_x=$("#"+e).attr("x"),$("#elm_pos_x").val(restore.pos_x),restore.pos_y=$("#"+e).attr("y"),$("#elm_pos_y").val(restore.pos_y),restore.color=$("#"+e).css("color"),$("#elm_color")[0].jscolor.fromString(restore.color),restore.url=$("#"+e).data("url"),$("#elm_url").val(restore.url),restore.frame=$("#"+e).data("frame"),$("#elm_frame").val(restore.frame),restore.action=$("#"+e).data("action"),$("#elm_action").val(restore.action),"svg"==a?($(".elm_config_svg").show(),restore.svg_content=$("#"+e).html(),$("#elm_svg_content").val(restore.svg_content),restore.viewBox=$("#"+e).attr("viewBox"),$("#elm_viewBox").val(restore.viewBox)):($(".elm_config_icon").show(),restore.icon=$("#"+e).data("icon"),$("#elm_icon").val(restore.icon),restore.source=$("#"+e).data("source"),getDataSources("elm_source",restore.source,!0),restore.threshold=$("#"+e).data("threshold"),$("#elm_threshold").val(restore.threshold));break;case"image":restore.width=$("#"+e).attr("width"),$("#elm_width").val(restore.width),restore.elm_height=$("#"+e).attr("height"),$("#elm_height").val(restore.elm_height),restore.pos_x=$("#"+e).attr("x"),$("#elm_pos_x").val(restore.pos_x),restore.pos_y=$("#"+e).attr("y"),$("#elm_pos_y").val(restore.pos_y),restore.href=$("#"+e).attr("href"),$("#elm_href").val(restore.href),restore.url=$("#"+e).data("url"),$("#elm_url").val(restore.url),restore.frame=$("#"+e).data("frame"),$("#elm_frame").val(restore.frame),restore.action=$("#"+e).data("action"),$("#elm_action").val(restore.action),restore.preserveAspectRatio=$("#"+e).attr("preserveAspectRatio"),$("#elm_preserveAspectRatio").val(restore.preserveAspectRatio),$(".elm_config_image").show()}let n=null;$("#config_bar").addClass("show");let c=0,d;function h(t){let a=document.createElementNS("http://www.w3.org/2000/svg","symbol");a.setAttribute("x",$("#"+e).attr("x")),a.setAttribute("y",$("#"+e).attr("y")),a.setAttribute("width",$("#"+e).attr("width")),a.setAttribute("height",$("#"+e).attr("height")),a.setAttribute("data-width",$("#"+e).attr("width")),a.setAttribute("data-height",$("#"+e).attr("height")),a.setAttribute("data-source",$("#"+e).data("source")),a.setAttribute("data-threshold",$("#"+e).data("threshold")),a.setAttribute("data-icon",t),a.setAttribute("class","iconify type_icon all_elements added_elements draggable draggable-group"),a.setAttribute("id",restore.id),a.setAttribute("style","color: "+restore.color+";"),$("#"+e).replaceWith(a)}$(".elm_config").off().on("input change paste",function(i){globalConfigChanged=!0,d==i.target.id||(c=i.target.value,d=i.target.id);let r=$("#elm_fill").val()?$("#elm_fill").val():"none";"elm_shadow"==i.target.id&&""==$("#elm_shadow_color").val()&&$("#elm_shadow_color")[0].jscolor.fromString("rgba(0, 0, 0, 0.7)"),"elm_shadow_color"==i.target.id&&$("#elm_shadow").prop("checked",!0),"elm_animation_type"==i.target.id&&("dots"==$(this).val()?($(".anim_type_duration").hide(),$(".anim_type_dots").show()):"duration"==$(this).val()?($(".anim_type_dots").hide(),$(".anim_type_duration").show()):$(".anim_type_duration, .anim_type_dots").hide()),"elm_fill_type"==i.target.id&&(-1==$(this).val()?$(".fill_type,.fill_type_value").hide():($(".fill_type").show(),"value"==$(this).val()?$(".fill_type_value").show():$(".fill_type_value").hide())),"elm_border_type"==i.target.id&&(-1==$(this).val()?$(".border_type,.border_type_value").hide():($(".border_type").show(),"value"==$(this).val()?$(".border_type_value").show():$(".border_type_value").hide())),"elm_border_reverse"==i.target.id&&($(this).is(":checked")?$(".border_reverse_value").show():($(".border_reverse_value").hide(),$("#elm_border_reverse_value").val("")));let o="drop-shadow(0px 3px 3px "+$("#elm_shadow_color").val()+")",s=$("path[id*="+restore.id+"]");s.length>0&&s.each(function(e){let t=s[e].id.split("_");connectElements(s[e].id,t[1],t[2])});let l=parseInt($("#svg_config").attr("height")),h=parseInt($("#svg_config").attr("width")),g=parseInt($("#elm_radius").val()),p=parseInt($("#elm_stroke").val())/2,u=parseInt($("#elm_font_size").val()),m,v;switch(t){case"rect":m=h-$("#elm_width").val()-p,v=l-$("#elm_height").val()-p,$("#elm_pos_x").val()-p>=0&&$("#elm_pos_x").val()<=m&&$("#elm_pos_y").val()-p>=0&&$("#elm_pos_y").val()<=v?(c=i.target.value,$("#"+e).attr({width:$("#elm_width").val(),height:$("#elm_height").val(),rx:$("#elm_rx").val(),x:$("#elm_pos_x").val(),y:$("#elm_pos_y").val()}),clearTimeout(n)):"input"==i.type&&(clearTimeout(n),n=setTimeout(()=>{$("#"+i.target.id).val(c)},500)),$("#"+e).data({frame:$("#elm_frame").val(),url:$("#elm_url").val(),fill_value:$("#elm_fill_value").val(),fill_type:$("#elm_fill_type").val(),fill_direction:$("#elm_fill_direction").val(),fill_max:$("#elm_fill_max").val(),border_value:$("#elm_border_value").val(),border_type:$("#elm_border_type").val(),border_direction:$("#elm_border_direction").val(),border_style:$("#elm_border_style").val(),border_max:$("#elm_border_max").val(),border_reverse_value:$("#elm_border_reverse_value").val(),border_reverse:$("#elm_border_reverse").is(":checked"),border_start:$("#elm_border_start").val(),source:$("#elm_source").val(),threshold:$("#elm_threshold").val(),css_general:$("#elm_css_general").val(),css_active_positive:$("#elm_css_active_positive").val(),css_inactive_positive:$("#elm_css_inactive_positive").val(),css_active_negative:$("#elm_css_active_negative").val(),css_inactive_negative:$("#elm_css_inactive_negative").val()}),$("#"+e).css({"stroke-width":$("#elm_stroke").val()+"px",stroke:$("#elm_color").val(),fill:r}),$("#elm_shadow").is(":checked")?$("#"+e).css({filter:o}):$("#"+e).css({filter:""}),$("#elm_border_value_fill")[0].jscolor.fromString($("#elm_color").val());break;case"circle":m=h-g-p,v=l-g-p,$("#elm_pos_x").val()-p-g>=0&&$("#elm_pos_y").val()-p-g>=0&&$("#elm_pos_x").val()<=m&&$("#elm_pos_y").val()-p>=0&&$("#elm_pos_y").val()<=v?(c=i.target.value,$("#"+e).attr({r:$("#elm_radius").val(),cx:$("#elm_pos_x").val(),cy:$("#elm_pos_y").val()}),clearTimeout(n)):"input"==i.type&&(clearTimeout(n),n=setTimeout(()=>{$("#"+i.target.id).val(c)},500)),$("#"+e).data({frame:$("#elm_frame").val(),url:$("#elm_url").val(),fill_value:$("#elm_fill_value").val(),fill_type:$("#elm_fill_type").val(),fill_direction:$("#elm_fill_direction").val(),fill_max:$("#elm_fill_max").val(),border_value:$("#elm_border_value").val(),border_type:$("#elm_border_type").val(),border_direction:$("#elm_border_direction").val(),border_style:$("#elm_border_style").val(),border_max:$("#elm_border_max").val(),border_reverse_value:$("#elm_border_reverse_value").val(),border_reverse:$("#elm_border_reverse").is(":checked"),border_start:$("#elm_border_start").val(),source:$("#elm_source").val(),threshold:$("#elm_threshold").val(),css_general:$("#elm_css_general").val(),css_active_positive:$("#elm_css_active_positive").val(),css_inactive_positive:$("#elm_css_inactive_positive").val(),css_active_negative:$("#elm_css_active_negative").val(),css_inactive_negative:$("#elm_css_inactive_negative").val()}),$("#"+e).css({"stroke-width":$("#elm_stroke").val()+"px",stroke:$("#elm_color").val(),fill:r}),$("#elm_shadow").is(":checked")?$("#"+e).css({filter:o}):$("#"+e).css({filter:""}),$("#elm_border_value_fill")[0].jscolor.fromString($("#elm_color").val());break;case"text":m=h-$("#elm_font_size").val(),v=l-$("#elm_font_size").val()/2,$("#elm_pos_x").val()-u>=0&&$("#elm_pos_x").val()<=m&&$("#elm_pos_y").val()-u/2>=0&&$("#elm_pos_y").val()<=v?(c=i.target.value,$("#"+e).attr({x:$("#elm_pos_x").val(),y:$("#elm_pos_y").val()}),clearTimeout(n)):"input"==i.type&&(clearTimeout(n),n=setTimeout(()=>{$("#"+i.target.id).val(c)},500)),$("#"+e).html($("#elm_text").val()),$("#"+e).data({frame:$("#elm_frame").val(),url:$("#elm_url").val(),unit:$("#elm_unit").val(),source:$("#elm_source").val(),source_option:$("#elm_source_option").val(),source_display:$("#elm_source_display").val(),threshold:$("#elm_threshold").val(),decimal_places:$("#elm_decimal_places").val(),calculate_kw:$("#elm_calculation").prop("checked"),convert:$("#elm_convert").prop("checked"),subtract:$("#elm_subtract").val(),append:$("#elm_append").val(),prepend:$("#elm_prepend").val(),css_general:$("#elm_css_general").val(),css_active_positive:$("#elm_css_active_positive").val(),css_inactive_positive:$("#elm_css_inactive_positive").val(),css_active_negative:$("#elm_css_active_negative").val(),css_inactive_negative:$("#elm_css_inactive_negative").val(),action:$("#elm_action").val()}),$("#"+e).css({"font-family":$("#elm_font").val(),"font-size":$("#elm_font_size").val()+"px",stroke:$("#elm_color").val(),fill:r,"text-anchor":$("#elm_align").val()}),$("#elm_shadow").is(":checked")?$("#"+e).css({filter:o}):$("#"+e).css({filter:""});break;case"use":let f=e.replace("line","anim");$("#"+f).data({threshold:$("#elm_threshold").val(),source:$("#elm_animation").val(),animation_properties:$("#elm_animation_properties").val(),animation_option:$("#elm_animation_option").prop("checked"),dots:$("#elm_dots").val(),duration:$("#elm_duration").val(),power:$("#elm_power").val(),animation_type:$("#elm_animation_type").val(),css_general:$("#elm_css_general").val(),css_active_positive:$("#elm_css_active_positive").val(),css_inactive_positive:$("#elm_css_inactive_positive").val(),css_active_negative:$("#elm_css_active_negative").val(),css_inactive_negative:$("#elm_css_inactive_negative").val()}),$("#"+f).css({stroke:$("#elm_color").val()}),$("#"+e).css({stroke:$("#elm_line_color").val()}),$("#elm_shadow").is(":checked")?$("#"+e).css({filter:o}):$("#"+e).css({filter:""});break;case"svg":m=h-$("#elm_width").val(),v=l-$("#elm_height").val(),$("#elm_pos_x").val()>=0&&$("#elm_pos_x").val()<=m&&$("#elm_pos_y").val()>=0&&$("#elm_pos_y").val()<=v?(c=i.target.value,$("#"+e).attr({width:$("#elm_width").val(),height:$("#elm_height").val(),x:$("#elm_pos_x").val(),y:$("#elm_pos_y").val()}),clearTimeout(n)):"input"==i.type&&(clearTimeout(n),n=setTimeout(()=>{$("#"+i.target.id).val(c)},500)),"svg"==a?($("#"+e).data({frame:$("#elm_frame").val(),url:$("#elm_url").val()}),$("#"+e).attr("viewBox",$("#elm_viewBox").val()),$("#"+e).html($("#elm_svg_content").val())):$("#"+e).data({frame:$("#elm_frame").val(),url:$("#elm_url").val(),css_general:$("#elm_css_general").val(),css_active_positive:$("#elm_css_active_positive").val(),css_inactive_positive:$("#elm_css_inactive_positive").val(),css_active_negative:$("#elm_css_active_negative").val(),css_inactive_negative:$("#elm_css_inactive_negative").val(),source:$("#elm_source").val(),threshold:$("#elm_threshold").val(),width:$("#elm_width").val(),height:$("#elm_height").val(),action:$("#elm_action").val()}),$("#"+e).css("color",$("#elm_color").val()),$("#elm_shadow").is(":checked")?$("#"+e).css({filter:o}):$("#"+e).css({filter:""});break;case"image":m=h-$("#elm_width").val(),v=l-$("#elm_height").val(),$("#elm_pos_x").val()>=0&&$("#elm_pos_x").val()<=m&&$("#elm_pos_y").val()>=0&&$("#elm_pos_y").val()<=v?(c=i.target.value,$("#"+e).attr({width:$("#elm_width").val(),height:$("#elm_height").val(),x:$("#elm_pos_x").val(),y:$("#elm_pos_y").val(),href:$("#elm_href").val(),preserveAspectRatio:$("#elm_preserveAspectRatio").val()}),clearTimeout(n)):"input"==i.type&&(clearTimeout(n),n=setTimeout(()=>{$("#"+i.target.id).val(c)},500)),$("#"+e).data({frame:$("#elm_frame").val(),url:$("#elm_url").val(),css_general:$("#elm_css_general").val(),action:$("#elm_action").val()}),$("#elm_shadow").is(":checked")?$("#"+e).css({filter:o}):$("#"+e).css({filter:""})}}),$("#elm_icon").on("input",function(){$(this).autocomplete({position:{my:"right top",at:"right bottom"},classes:{"ui-autocomplete":"icon_finder"},source:function(e,t){$.ajax({minLength:1,url:"https://api.iconify.design/search?",type:"GET",data:{query:e.term},success:function(e){t($.map(e.icons,function(e){return{label:e}}))}})},select:function(e,t){return h(t.item.value),t.item.value}}).autocomplete("instance")._renderItem=function(e,t){return $("<li class='ui-menu-item'>").append("<div class='ui-menu-item-wrapper'><span class='iconify' data-width='24' data-icon='"+t.label+"'></span><span style='font-weight: normal; padding-left:10px;'>"+t.label+"</span></div>").appendTo(e)}}),$("#restore_element").off().click(function(){if(0===$("#"+e).length){let i=$("#elm_fill").val()?$("#elm_fill").val():"none";addElement({format:t,subType:a,id:restore.id,svg_content:$("#elm_svg_content").val(),radius:$("#elm_radius").val(),width:$("#elm_width").val(),height:$("#elm_height").val(),rx:$("#elm_rx").val(),stroke:$("#elm_stroke").val(),pos_x:$("#elm_pos_x").val(),pos_y:$("#elm_pos_y").val(),color:$("#elm_color").val(),line_color:$("#elm_line_color").val(),fill:i,icon:$("#elm_icon").val(),connPoint1:restore.startSlot,connPoint2:restore.endSlot,text:$("#elm_text").val(),align:$("#elm_align").val(),href:$("#elm_href").val(),preserveAspectRatio:$("#elm_preserveAspectRatio").val(),font_size:$("#elm_font_size").val(),font_family:$("#elm_font").val(),unit:$("#elm_unit").val(),append:$("#elm_append").val(),prepend:$("#elm_prepend").val(),css_general:$("#elm_css_general").val(),css_active_positive:$("#elm_css_active_positive").val(),css_inactive_positive:$("#elm_css_inactive_positive").val(),css_active_negative:$("#elm_css_active_negative").val(),css_inactive_negative:$("#elm_css_inactive_negative").val(),source:$("#elm_source").val(),source_option:$("#elm_source_option").val(),source_display:$("#elm_source_display").val(),degree:restore.degree,shadow:$("#elm_shadow_color").val(),animation:$("#elm_animation").val(),animation_properties:$("#elm_animation_properties").val(),animation_option:$("#elm_animation_option").prop("checked"),threshold:$("#elm_threshold").val(),calculate_kw:$("#elm_calculation").prop("checked"),convert:$("#elm_convert").prop("checked"),decimal_places:$("#elm_decimal_places").val(),url:$("#elm_url").val(),frame:$("#elm_frame").val(),fill_value:$("#elm_fill_value").val(),fill_type:$("#elm_fill_type").val(),fill_direction:$("#elm_fill_direction").val(),fill_max:$("#elm_fill_max").val(),border_value:$("#elm_border_value").val(),border_type:$("#elm_border_type").val(),border_direction:$("#elm_border_direction").val(),border_style:$("#elm_border_style").val(),border_max:$("#elm_border_max").val(),border_reverse_value:$("#elm_border_reverse_value").val(),border_reverse:$("#elm_border_reverse").is(":checked"),border_start:$("#elm_border_start").val(),dots:$("#elm_dots").val(),duration:$("#elm_duration").val(),power:$("#elm_power").val(),animation_type:$("#elm_animation_type").val(),subtract:$("#elm_subtract").val(),action:$("#elm_action").val()}),$("#"+e).length>0?(successMessage(translateWord("succ_msg_restore")),$(".elm_config, #reconnect_elements").prop("disabled",!1)):(failedMessage(translateWord("failmsgrestore")),$(".elm_config, #reconnect_elements").prop("disabled",!0))}else{Object.entries(restore).forEach(e=>{let[t,a]=e;$("#elm_"+t).val(a)});let r="none"==restore.fill||""==restore.fill||void 0==restore.fill?"none":restore.fill,o="";switch(restore.shadow_color?(o="drop-shadow(0px 3px 3px "+restore.shadow_color+")",$("#elm_shadow").prop("checked",!0)):$("#elm_shadow").prop("checked",!1),restore.border_reverse?($("#elm_border_reverse").prop("checked",!0),$(".border_reverse_value").show()):($("#elm_border_reverse").prop("checked",!1),$(".border_reverse_value").hide()),$("#elm_fill")[0].jscolor.fromString("none"==r?"":r),$("#elm_color")[0].jscolor.fromString(restore.color?restore.color:""),$("#elm_fill_value")[0].jscolor.fromString(restore.fill_value?restore.fill_value:""),$("#elm_border_value")[0].jscolor.fromString(restore.border_value?restore.border_value:""),$("#elm_line_color")[0].jscolor.fromString(restore.line_color?restore.line_color:""),$("#elm_shadow_color")[0].jscolor.fromString(restore.shadow_color?restore.shadow_color:""),$("#elm_border_reverse_value")[0].jscolor.fromString(restore.border_reverse_value?restore.border_reverse_value:""),t){case"rect":$("#"+e).attr({width:restore.width,height:restore.height,rx:restore.rx,x:restore.pos_x,y:restore.pos_y}),$("#"+e).data({url:restore.url,frame:restore.frame,fill_value:restore.fill_value,fill_type:restore.fill_type,fill_direction:restore.fill_direction,fill_max:restore.fill_max,border_value:restore.border_value,border_type:restore.border_type,border_direction:restore.border_direction,border_style:restore.border_style,border_max:restore.border_max,border_reverse_value:restore.border_reverse_value,border_reverse:restore.border_reverse,border_start:restore.border_start,source:restore.source,threshold:restore.threshold,css_general:restore.css_general,css_active_positive:restore.css_active_positive,css_inactive_positive:restore.css_inactive_positive,css_active_negative:restore.css_active_negative,css_inactive_negative:restore.css_inactive_negative}),$("#"+restore.id).css({"stroke-width":restore.stroke+"px",stroke:restore.color,fill:r,filter:o});break;case"circle":$("#"+e).attr({r:restore.radius,cx:restore.pos_x,cy:restore.pos_y}),$("#"+e).data({url:restore.url,frame:restore.frame,fill_value:restore.fill_value,fill_type:restore.fill_type,fill_direction:restore.fill_direction,fill_max:restore.fill_max,border_value:restore.border_value,border_type:restore.border_type,border_direction:restore.border_direction,border_style:restore.border_style,border_max:restore.border_max,border_reverse_value:restore.border_reverse_value,border_reverse:restore.border_reverse,border_start:restore.border_start,source:restore.source,threshold:restore.threshold,css_general:restore.css_general,css_active_positive:restore.css_active_positive,css_inactive_positive:restore.css_inactive_positive,css_active_negative:restore.css_active_negative,css_inactive_negative:restore.css_inactive_negative}),$("#"+restore.id).css({"stroke-width":restore.stroke+"px",stroke:restore.color,fill:r,filter:o});break;case"text":$("#"+e).attr({x:restore.pos_x,y:restore.pos_y,transform:"rotate("+restore.degree+","+restore.pos_x+","+restore.pos_y+")"}),$("#"+e).html(restore.text),$("#"+e).css({"font-family":restore.font,"font-size":restore.font_size+"px",stroke:restore.color,fill:r,filter:o,"text-anchor":restore.align}),$("#"+e).data({url:restore.url,frame:restore.frame,css_general:restore.css_general,css_active_positive:restore.css_active_positive,css_inactive_positive:restore.css_inactive_positive,css_active_negative:restore.css_active_negative,css_inactive_negative:restore.css_inactive_negative}),"datasource"==a&&($("#elm_calculation").prop("checked",!0===restore.calculate_kw),$("#elm_convert").prop("checked",!0===restore.convert),$("#"+e).data({unit:restore.unit,source:restore.source,source_option:restore.source_option,source_display:restore.source_display,calculate_kw:restore.calculate_kw,convert:restore.convert,threshold:restore.threshold,decimal_places:restore.decimal_places,subtract:restore.subtract,append:restore.append,prepend:restore.prepend,action:restore.action}));break;case"use":let s=e.replace("line","anim");$("#"+s).data({animation:restore.animation,animation_properties:restore.animation_properties,animation_option:restore.animation_option,dots:restore.elm_dots,duration:restore.elm_duration,power:restore.elm_power,animation_type:restore.elm_animation_type,css_general:restore.css_general,css_active_positive:restore.css_active_positive,css_inactive_positive:restore.css_inactive_positive,css_active_negative:restore.css_active_negative,css_inactive_negative:restore.css_inactive_negative}),$("#"+s).css({stroke:restore.color}),$("#"+e).css({stroke:restore.line_color,filter:o});break;case"svg":"svg"==a?($("#"+e).data({url:restore.url,frame:restore.frame,css_general:restore.css_general}),$("#"+e).attr("viewBox",restore.viewBox),$("#"+e).html(restore.svg_content)):(h(restore.icon),$("#"+e).data({url:restore.url,frame:restore.frame,css_general:restore.css_general,css_active_positive:restore.css_active_positive,css_inactive_positive:restore.css_inactive_positive,css_active_negative:restore.css_active_negative,css_inactive_negative:restore.css_inactive_negative,threshold:restore.threshold,source:restore.source,action:restore.action})),$("#"+e).attr({width:restore.width,height:restore.height,x:restore.pos_x,y:restore.pos_y}),$("#"+e).css({color:restore.color,filter:o});break;case"image":$("#"+e).data({url:restore.url,frame:restore.frame,css_general:restore.css_general,action:restore.action}),$("#"+e).attr({width:restore.width,height:restore.height,x:restore.pos_x,y:restore.pos_y,href:restore.href,preserveAspectRatio:restore.preserveAspectRatio}),$("#"+e).css({color:restore.color,filter:o})}let l=$("path[id*="+restore.id+"]");l.length>0&&l.each(function(e){let t=l[e].id.split("_");connectElements(l[e].id,t[1],t[2],!0)})}}),$("#delete_element").off().click(function(){if(this.blur(),$(".elm_config, #reconnect_elements").prop("disabled",!0),"use"==t)$("#"+e.replace("line","anim")).remove(),$("#"+e.replace("line_","")).remove(),$("#"+e).remove(),successMessage(translateWord("succ_msg_line_delete"));else{let a=$("[id^=line_path"),i=!0;a.each(function(){let e=this.id.split("_");if(restore.id==e[2]||restore.id==e[3])return i=!1,!1}),i?($("#"+e).remove(),successMessage(translateWord("succ_msg_delete"))):failedMessage(translateWord("failmsg_element_delete"))}globalConfigChanged=!0}),$("#rotate_cw, #rotate_ccw").off().click(function(t){if($("#"+e).length>0){let a=!0==t.target.id?t.target.id:$(this).closest("a").attr("id"),i=getRotationDegrees($("#"+e));i+="rotate_cw"==a?45:-45,$("#"+e).css({"transform-box":"fill-box",transform:"rotate("+i+"deg)"})}else console.log("Element deleted! No degree possible!")}),$(".changeOrder").off().click(function(t){let a=!0==t.target.id?t.target.id:$(this).closest("a").attr("id");$("#"+e).index();let i=$("#"+e).next(),r=$("#"+e).prev();"changeOrder_foreground"==a&&(i.length>0?$("#"+e).insertAfter(i).data("position",$("#"+e).index()):failedMessage(translateWord("failmsg_max_foreground"))),"changeOrder_background"==a&&(r.length>0?$("#"+e).insertBefore(r).data("position",$("#"+e).index()):failedMessage(translateWord("failmsg_max_background"))),console.log("New Index: "+$("#"+e).data("position"))})}function hideConfigBar(){$(".all_elements").removeClass("faded_out"),$("#config_bar").removeClass("show"),$("#config_bar_content").scrollTop(0),$(".elm_config").off().val(""),$("#tab1_config").prop("checked",!0),$("#elm_icon").hasClass("ui-autocomplete-input")&&$("#elm_icon").autocomplete("destroy"),hideIframe()}function hideIframe(){$("#loading").fadeOut("fast",function(){$("#overlay_frame").attr("src",""),$("#display_container").hide()})}function hideStateExplorer(){$("#loading").fadeOut("fast",function(){$("#stateExplorerContainer").hide(),$("#stateExplorer").scrollTop(0)})}function addElement(e,t){let a="",i="all_elements added_elements draggable  "+e.css_general;switch(e.shadow&&(a=" filter: drop-shadow(0px 3px 3px "+e.shadow+");"),e.format){case"rect":let r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("x",e.pos_x),r.setAttribute("y",e.pos_y),r.setAttribute("width",e.width),r.setAttribute("height",e.height),r.setAttribute("rx",e.rx),r.setAttribute("class",i+" type_rect connector"),r.setAttribute("data-url",e.url),r.setAttribute("data-frame",e.frame),r.setAttribute("data-fill_value",e.fill_value),r.setAttribute("data-fill_type",e.fill_type),r.setAttribute("data-fill_direction",e.fill_direction),r.setAttribute("data-fill_max",e.fill_max),r.setAttribute("data-border_value",e.border_value),r.setAttribute("data-border_type",e.border_type),r.setAttribute("data-border_direction",e.border_direction),r.setAttribute("data-border_style",e.border_style),r.setAttribute("data-border_max",e.border_max),r.setAttribute("data-border_reverse_value",e.border_reverse_value),r.setAttribute("data-border_reverse",e.border_reverse),r.setAttribute("data-border_start",e.border_start),r.setAttribute("data-source",e.source),r.setAttribute("data-threshold",e.threshold),r.setAttribute("data-css_general",e.css_general),r.setAttribute("data-css_active_positive",e.css_active_positive),r.setAttribute("data-css_inactive_positive",e.css_inactive_positive),r.setAttribute("data-css_active_negative",e.css_active_negative),r.setAttribute("data-css_inactive_negative",e.css_inactive_negative),r.setAttribute("data-slot","element"),r.setAttribute("id",e.id),r.setAttribute("style","stroke: "+e.color+"; stroke-width: "+e.stroke+"px; fill:"+e.fill+";"+a),$(r).appendTo("#placeholder_elements");break;case"circle":let o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx",e.pos_x),o.setAttribute("cy",e.pos_y),o.setAttribute("r",e.radius),o.setAttribute("class",i+" type_circle connector"),o.setAttribute("data-url",e.url),o.setAttribute("data-frame",e.frame),o.setAttribute("data-fill_value",e.fill_value),o.setAttribute("data-fill_type",e.fill_type),o.setAttribute("data-fill_direction",e.fill_direction),o.setAttribute("data-fill_max",e.fill_max),o.setAttribute("data-border_value",e.border_value),o.setAttribute("data-border_type",e.border_type),o.setAttribute("data-border_direction",e.border_direction),o.setAttribute("data-border_style",e.border_style),o.setAttribute("data-border_max",e.border_max),o.setAttribute("data-border_reverse_value",e.border_reverse_value),o.setAttribute("data-border_reverse",e.border_reverse),o.setAttribute("data-border_start",e.border_start),o.setAttribute("data-source",e.source),o.setAttribute("data-threshold",e.threshold),o.setAttribute("data-css_general",e.css_general),o.setAttribute("data-css_active_positive",e.css_active_positive),o.setAttribute("data-css_inactive_positive",e.css_inactive_positive),o.setAttribute("data-css_active_negative",e.css_active_negative),o.setAttribute("data-css_inactive_negative",e.css_inactive_negative),o.setAttribute("data-slot","element"),o.setAttribute("id",e.id),o.setAttribute("style","stroke: "+e.color+"; stroke-width: "+e.stroke+"px; fill:"+e.fill+";"+a),$(o).appendTo("#placeholder_elements");break;case"text":let s=document.createElementNS("http://www.w3.org/2000/svg","text"),l="";e.degree&&(l=" transform-box: fill-box; transform: rotate("+e.degree+"deg);"),s.setAttribute("x",e.pos_x),s.setAttribute("y",e.pos_y),s.setAttribute("id",e.id),s.setAttribute("dominant-baseline","central"),s.setAttribute("style","stroke: "+e.color+"; fill: "+e.fill+"; font-family: "+e.font_family+"; text-anchor: "+e.align+"; transform-origin:50% 50%; font-size: "+e.font_size+"px;"+l+a),s.setAttribute("data-css_general",e.css_general),s.setAttribute("data-url",e.url),s.setAttribute("data-frame",e.frame),"datasource"==e.subType?(s.setAttribute("data-unit",e.unit),s.setAttribute("data-append",e.append),s.setAttribute("data-prepend",e.prepend),s.setAttribute("data-type","datasource"),s.setAttribute("class",i+" type_datasource"),s.setAttribute("data-source",e.source),s.setAttribute("data-css_active_positive",e.css_active_positive),s.setAttribute("data-css_inactive_positive",e.css_inactive_positive),s.setAttribute("data-css_active_negative",e.css_active_negative),s.setAttribute("data-css_inactive_negative",e.css_inactive_negative),s.setAttribute("data-source_option",e.source_option),s.setAttribute("data-source_display",e.source_display),s.setAttribute("data-threshold",e.threshold),s.setAttribute("data-calculate_kw",e.calculate_kw),s.setAttribute("data-convert",e.convert),s.setAttribute("data-decimal_places",e.decimal_places),s.setAttribute("data-action",e.action),s.setAttribute("data-subtract",JSON.stringify(e.subtract))):(s.setAttribute("data-type","text"),s.setAttribute("class",i+" type_text ")),s.innerHTML=e.text,$(s).appendTo("#placeholder_text");break;case"svg":case"icon":let n=document.createElementNS("http://www.w3.org/2000/svg","symbol");"svg"==e.subType?((n=document.createElementNS("http://www.w3.org/2000/svg","svg")).setAttribute("data-type","svg"),n.setAttribute("class",i+" type_svg draggable-group"),n.setAttribute("viewBox","0 0 "+e.width+" "+e.height),n.setAttribute("style",a),n.innerHTML=e.svg_content):(n.setAttribute("class",i+" type_icon draggable-group iconify"),n.setAttribute("data-icon",e.icon),n.setAttribute("data-width",e.width),n.setAttribute("data-height",e.height),n.setAttribute("data-type","icon"),n.setAttribute("style","color: "+e.color+";"+a),n.setAttribute("data-source",e.source),n.setAttribute("data-threshold",e.threshold),n.setAttribute("data-css_active_positive",e.css_active_positive),n.setAttribute("data-css_inactive_positive",e.css_inactive_positive),n.setAttribute("data-css_active_negative",e.css_active_negative),n.setAttribute("data-css_inactive_negative",e.css_inactive_negative),n.setAttribute("data-action",e.action)),n.setAttribute("data-url",e.url),n.setAttribute("data-frame",e.frame),n.setAttribute("data-css_general",e.css_general),n.setAttribute("x",e.pos_x),n.setAttribute("y",e.pos_y),n.setAttribute("id",e.id),n.setAttribute("width",e.width),n.setAttribute("height",e.height),"svg"==e.subType?$(n).appendTo("#placeholder_elements"):$(n).appendTo("#placeholder_icons");break;case"image":let c=document.createElementNS("http://www.w3.org/2000/svg","image");c.setAttribute("class",i+" type_image draggable"),c.setAttribute("data-css_general",e.css_general),c.setAttribute("data-url",e.url),c.setAttribute("data-frame",e.frame),c.setAttribute("data-action",e.action),c.setAttribute("x",e.pos_x),c.setAttribute("y",e.pos_y),c.setAttribute("id",e.id),c.setAttribute("preserveAspectRatio",e.preserveAspectRatio),c.setAttribute("width",e.width),c.setAttribute("height",e.height),c.setAttribute("href",e.href),c.setAttribute("style",a),$(c).appendTo("#placeholder_elements");break;case"use":let d=e.id.replace("line_",""),h=d.split("_");addElement({format:"def",id:d,connPoint1:e.connPoint1,connPoint2:e.connPoint2}),addElement({format:"line",id:"line_"+d,color:e.line_color,href:"#"+d,shadow:e.shadow}),addElement({format:"animation",id:"anim_"+d,color:e.color,href:"#"+d,source:e.animation,animation_properties:e.animation_properties,animation_option:e.animation_option,threshold:e.threshold,dots:e.dots,duration:e.duration,power:e.power,animation_type:e.animation_type,css_general:e.css_general,css_active_positive:e.css_active_positive,css_inactive_positive:e.css_inactive_positive,css_active_negative:e.css_active_negative,css_inactive_negative:e.css_inactive_negative}),connectElements(d,h[1],h[2]);break;case"def":let g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("id",e.id),g.setAttribute("class","type_def"),g.setAttribute("data-start-slot",e.connPoint1),g.setAttribute("data-end-slot",e.connPoint2),g.setAttribute("d",e.d),$(g).appendTo("#placeholder_defs");break;case"line":let p=document.createElementNS("http://www.w3.org/2000/svg","use");p.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.href),p.setAttribute("id",e.id),p.setAttribute("class","line type_line all_elements"),p.setAttribute("style","stroke: "+e.color+";"+a),$(p).appendTo("#placeholder_lines"),displayMode||$(".line").off().click(function(e){showConfigBar(e.target.id,e.target.tagName.toLowerCase())});break;case"animation":i="type_animation all_elements anim_element",$("#enable_animation").prop("checked")?i+=" animation":i+=" no_animation";let u=document.createElementNS("http://www.w3.org/2000/svg","use");u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.href),u.setAttribute("id",e.id),u.setAttribute("class",i),u.setAttribute("style","stroke: "+e.color+";"),u.setAttribute("data-source",e.source),u.setAttribute("data-css_general",e.css_general),u.setAttribute("data-css_active_positive",e.css_active_positive),u.setAttribute("data-css_inactive_positive",e.css_inactive_positive),u.setAttribute("data-css_active_negative",e.css_active_negative),u.setAttribute("data-css_inactive_negative",e.css_inactive_negative),u.setAttribute("data-animation_properties",e.animation_properties),u.setAttribute("data-animation_option",e.animation_option),u.setAttribute("data-threshold",e.threshold),u.setAttribute("data-dots",e.dots),u.setAttribute("data-duration",e.duration),u.setAttribute("data-power",e.power),u.setAttribute("data-animation_type",e.animation_type),$(u).appendTo("#placeholder_animations")}t&&t()}function generateMaxID(){$(".added_elements").each(function(){max_elm_id=Math.max(this.id,max_elm_id)}),max_elm_id++}function getRandomInt(e){return Math.floor(Math.random()*e)}function getRandomRGBA(){var e=Math.round,t=Math.random;return"rgba("+e(255*t())+","+e(255*t())+","+e(255*t())+",1)"}function addDataSourceRow(e,t,a){$(".btn-cancel").trigger("click");let i=!0;if($(".data-table tbody tr").each(function(){if($("td:eq(1)",this).text().toLowerCase()==t.toLowerCase())return $(this).effect("highlight",{color:"lightgreen"},3e3),i=!1,!1}),i){if(-1==e){console.log("Need new Key!");let r=-1;$(".data-table tbody tr").each(function(){r=Math.max($(this).data("id"),r)}),r++,console.log("Found: "+r),e=r}let o="<tr data-source='"+t+"' data-alias='"+a+"' data-id='"+e+"'><td>"+a+"</td><td>"+t+"</td><td><button class='all_datasource ds_buttons btn-edit'><span class='iconify' data-height='24' data-icon='mdi:pencil'>Edit</span></button><button class='all_datasource ds_buttons btn-delete'><span class='iconify red_icon' data-height='24' data-icon='mdi:delete'>Delete</span></button></td></tr>";$(".data-table tbody").append(o),$(".data-table tbody").find("tr:last-child").hide().fadeIn("slow"),$("#ds_tmp_line").remove()}}function getdataSourceCellValue(e,t){return $(e).children("td").eq(t).text()}function dataSourceComparer(e){return function(t,a){var i=getdataSourceCellValue(t,e),r=getdataSourceCellValue(a,e);return $.isNumeric(i)&&$.isNumeric(r)?i-r:i.toString().localeCompare(r)}}function loadAdditionalJSFile(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,t.onload=function(){console.log("Loaded additional file: "+e)},document.body.appendChild(t)}function saveWorkspace(e=!1,t){let a=[];(a=Array.isArray($("#calc_consumption_production").val())?0==$("#calc_consumption_production").val().length?[-1]:$("#calc_consumption_production").val():[-1]).map(e=>parseInt(e));let i,r={},o={},s={},l={},n={},c={};r={basic:{enable_grid:!!$("#enable_grid").is(":checked"),enable_animation:!!$("#enable_animation").is(":checked"),enable_area_catch:!!$("#enable_area_catch").is(":checked"),enable_config_icon:!!$("#enable_config_icon").is(":checked"),enable_last_id:!!$("#enable_last_id").is(":checked"),enable_icon_proxy:!!$("#enable_proxy").is(":checked"),height:parseInt($("#svg_config").attr("height")),width:parseInt($("#svg_config").attr("width")),styles:$("#own_css").val(),font:{family:$("#basic_font_family").val(),size:$("#basic_font_size").val(),color:$("#basic_font_color").val(),fill:$("#basic_font_fill").val(),align:$("#basic_font_align").val()},rect:{height:parseInt($("#basic_rect_height").val()),width:parseInt($("#basic_rect_width").val()),corners:parseInt($("#basic_rect_corners").val())},circle:{radius:parseInt($("#basic_circle_radius").val())},elm:{stroke_width:parseInt($("#basic_stroke_width").val()),color:$("#basic_elm_color").val(),fill:$("#basic_elm_fill").val(),pos_x:parseInt($("#basic_pos_x").val()),pos_y:parseInt($("#basic_pos_y").val())},icon:{height:parseInt($("#basic_icon_height").val()),width:parseInt($("#basic_icon_width").val()),color:$("#basic_icon_color").val()}},calculation:{battery:{dod:parseInt($("#calc_battery_dod").val())||0,capacity:parseInt($("#calc_battery_capacity").val())||0,percent:parseInt($("#calc_battery_percent").val()),charge:parseInt($("#calc_battery_charge").val()),charge_prop:!!$("#calc_battery_charge_prop").is(":checked"),charge_kw:!!$("#calc_battery_charge_kw").is(":checked"),discharge:parseInt($("#calc_battery_discharge").val()),discharge_prop:!!$("#calc_battery_discharge_prop").is(":checked"),discharge_kw:!!$("#calc_battery_discharge_kw").is(":checked")},consumption:{production:a,production_kw:!!$("#calc_consumption_production_kw").is(":checked"),gridFeed:parseInt($("#calc_consumption_gridFeed").val()),gridFeed_kw:!!$("#calc_consumption_gridFeed_kw").is(":checked"),gridFeed_prop:!!$("#calc_consumption_gridFeed_prop").is(":checked"),gridConsume:parseInt($("#calc_consumption_gridConsume").val()),gridConsume_kw:!!$("#calc_consumption_gridConsume_kw").is(":checked"),gridConsume_prop:!!$("#calc_consumption_gridConsume_prop").is(":checked"),batteryCharge:parseInt($("#calc_consumption_batteryCharge").val()),batteryCharge_kw:!!$("#calc_consumption_batteryCharge_kw").is(":checked"),batteryCharge_prop:!!$("#calc_consumption_batteryCharge_prop").is(":checked"),batteryDischarge:parseInt($("#calc_consumption_batteryDischarge").val()),batteryDischarge_kw:!!$("#calc_consumption_batteryDischarge_kw").is(":checked"),batteryDischarge_prop:!!$("#calc_consumption_batteryDischarge_prop").is(":checked")}},animation:{},animation_configuration:{},line:{},elements:{},defs:{},lines:{},animations:{},datasources:{}},$(".added_elements").length>0?($(".type_circle").each(function(){o[i=this.id]={type:"circle",id:parseInt(i),radius:parseInt($(this).attr("r")),pos_x:parseInt($(this).attr("cx")),pos_y:parseInt($(this).attr("cy")),fill:$(this).css("fill"),color:$(this).css("stroke"),stroke:parseInt($(this).css("stroke-width").replace("px","")),shadow:getShadowColor(i),frame:$(this).data("frame"),url:$(this).data("url")?$(this).data("url"):void 0,fill_value:$(this).data("fill_value")||null,fill_type:$(this).data("fill_type")||-1,fill_direction:$(this).data("fill_direction")||90,fill_max:$(this).data("fill_max")||null,border_value:$(this).data("border_value")||null,border_type:$(this).data("border_type")||-1,border_direction:$(this).data("border_direction")||"cw",border_style:$(this).data("border_style")||"round",border_max:$(this).data("border_max")||null,border_reverse_value:$(this).data("border_reverse_value")||null,border_reverse:$(this).data("border_reverse")||!1,border_start:$(this).data("border_start")||180,source:$(this).data("source")>=0?$(this).data("source"):-1,threshold:parseInt($(this).data("threshold"))||0,css_general:$(this).data("css_general")?$(this).data("css_general"):void 0,css_active_positive:$(this).data("css_active_positive")?$(this).data("css_active_positive"):void 0,css_inactive_positive:$(this).data("css_inactive_positive")?$(this).data("css_inactive_positive"):void 0,css_active_negative:$(this).data("css_active_negative")?$(this).data("css_active_negative"):void 0,css_inactive_negative:$(this).data("css_inactive_negative")?$(this).data("css_inactive_negative"):void 0}}),$(".type_rect").each(function(){o[i=this.id]={position:parseInt($(this).index()),type:"rect",id:parseInt(i),rx:parseInt($(this).attr("rx")),height:parseInt($(this).attr("height")),width:parseInt($(this).attr("width")),pos_x:parseInt($(this).attr("x")),pos_y:parseInt($(this).attr("y")),fill:$(this).css("fill"),color:$(this).css("stroke"),stroke:parseInt($(this).css("stroke-width").replace("px","")),shadow:getShadowColor(i),frame:$(this).data("frame"),url:$(this).data("url")?$(this).data("url"):void 0,fill_value:$(this).data("fill_value")||null,fill_type:$(this).data("fill_type")||-1,fill_direction:$(this).data("fill_direction")||90,fill_max:$(this).data("fill_max")||null,border_value:$(this).data("border_value")||null,border_type:$(this).data("border_type")||-1,border_direction:$(this).data("border_direction")||"cw",border_style:$(this).data("border_style")||"round",border_max:$(this).data("border_max")||null,border_reverse_value:$(this).data("border_reverse_value")||null,border_reverse:$(this).data("border_reverse")||!1,border_start:$(this).data("border_start")||180,source:$(this).data("source")>=0?$(this).data("source"):-1,threshold:parseInt($(this).data("threshold"))||0,css_general:$(this).data("css_general")?$(this).data("css_general"):void 0,css_active_positive:$(this).data("css_active_positive")?$(this).data("css_active_positive"):void 0,css_inactive_positive:$(this).data("css_inactive_positive")?$(this).data("css_inactive_positive"):void 0,css_active_negative:$(this).data("css_active_negative")?$(this).data("css_active_negative"):void 0,css_inactive_negative:$(this).data("css_inactive_negative")?$(this).data("css_inactive_negative"):void 0}}),$(".type_text").each(function(){o[i=this.id]={position:parseInt($(this).index()),type:"text",id:parseInt(i),pos_x:parseInt($(this).attr("x")),pos_y:parseInt($(this).attr("y")),color:$(this).css("stroke"),fill:$(this).css("fill"),font_family:$(this).css("font-family"),font_size:parseInt($(this).css("font-size").replace("px","")),degree:getRotationDegrees($(this)),align:$(this).css("text-anchor"),text:$(this).html(),shadow:getShadowColor(i),css_general:$(this).data("css_general")?$(this).data("css_general"):void 0,frame:$(this).data("frame"),url:$(this).data("url")?$(this).data("url"):void 0}}),$(".type_datasource").each(function(){i=this.id;let e=[];(e=Array.isArray($(this).data("subtract"))?0==$(this).data("subtract").length?[-1]:$(this).data("subtract"):[-1]).map(e=>parseInt(e)),o[i]={position:parseInt($(this).index()),type:"text",subType:"datasource",id:parseInt(i),pos_x:parseInt($(this).attr("x")),pos_y:parseInt($(this).attr("y")),color:$(this).css("stroke"),fill:$(this).css("fill"),font_family:$(this).css("font-family"),font_size:parseInt($(this).css("font-size").replace("px","")),degree:getRotationDegrees($(this)),align:$(this).css("text-anchor"),text:"ID "+i,unit:$(this).data("unit"),append:$(this).data("append")?$(this).data("append"):void 0,prepend:$(this).data("prepend")?$(this).data("prepend"):void 0,source:$(this).data("source"),source_option:$(this).data("source_option")||-1,source_display:$(this).data("source_display")||"value",shadow:getShadowColor(i),threshold:parseInt($(this).data("threshold"))||0,calculate_kw:$(this).data("calculate_kw")||!1,convert:$(this).data("convert")||!1,decimal_places:parseInt($(this).data("decimal_places"))||0,action:$(this).data("action")?$(this).data("action"):void 0,subtract:e,css_general:$(this).data("css_general")?$(this).data("css_general"):void 0,css_active_positive:$(this).data("css_active_positive")?$(this).data("css_active_positive"):void 0,css_inactive_positive:$(this).data("css_inactive_positive")?$(this).data("css_inactive_positive"):void 0,css_active_negative:$(this).data("css_active_negative")?$(this).data("css_active_negative"):void 0,css_inactive_negative:$(this).data("css_inactive_negative")?$(this).data("css_inactive_negative"):void 0,frame:$(this).data("frame"),url:$(this).data("url")?$(this).data("url"):void 0}}),$(".type_icon").each(function(){o[i=this.id]={position:parseInt($(this).index()),type:"icon",id:i,icon:$(this).data("icon"),width:$(this).data("width"),height:$(this).data("height"),color:$(this).css("color"),pos_x:$(this).attr("x"),pos_y:$(this).attr("y"),shadow:getShadowColor(i),css_general:$(this).data("css_general")?$(this).data("css_general"):void 0,css_active_positive:$(this).data("css_active_positive")?$(this).data("css_active_positive"):void 0,css_inactive_positive:$(this).data("css_inactive_positive")?$(this).data("css_inactive_positive"):void 0,css_active_negative:$(this).data("css_active_negative")?$(this).data("css_active_negative"):void 0,css_inactive_negative:$(this).data("css_inactive_negative")?$(this).data("css_inactive_negative"):void 0,source:$(this).data("source"),threshold:parseInt($(this).data("threshold"))||0,frame:$(this).data("frame"),url:$(this).data("url")?$(this).data("url"):void 0,action:$(this).data("action")?$(this).data("action"):void 0}}),$(".type_svg").each(function(){o[i=this.id]={position:parseInt($(this).index()),type:"svg",subType:"svg",id:i,width:$(this).data("width"),height:$(this).data("height"),color:$(this).css("color"),pos_x:$(this).attr("x"),pos_y:$(this).attr("y"),shadow:getShadowColor(i),css_general:$(this).data("css_general")?$(this).data("css_general"):void 0,svg_content:$(this).html()||"",frame:$(this).data("frame"),url:$(this).data("url")?$(this).data("url"):void 0}}),$(".type_image").each(function(){o[i=this.id]={position:parseInt($(this).index()),type:"image",id:i,width:$(this).data("width"),height:$(this).data("height"),pos_x:$(this).attr("x"),pos_y:$(this).attr("y"),shadow:getShadowColor(i),css_general:$(this).data("css_general")?$(this).data("css_general"):void 0,href:$(this).attr("href"),preserveAspectRatio:$(this).attr("preserveAspectRatio"),frame:$(this).data("frame"),url:$(this).data("url")?$(this).data("url"):void 0,action:$(this).data("action")?$(this).data("action"):void 0}}),$(".type_def").each(function(){s[i=this.id]={type:"def",id:i,d:$(this).attr("d"),startSlot:$(this).data("start-slot"),endSlot:$(this).data("end-slot")}}),$(".type_line").each(function(){l[i=this.id]={type:"line",id:i,href:$(this).attr("xlink:href"),color:$(this).css("stroke"),shadow:getShadowColor(i)}}),$(".type_animation").each(function(){n[i=this.id]={type:"animation",id:i,href:$(this).attr("xlink:href"),color:$(this).css("stroke"),source:$(this).data("source"),threshold:$(this).data("threshold"),animation_properties:$(this).data("animation_properties"),animation_option:$(this).data("animation_option")||!1,dots:-1!=$(this).data("animation_type")?$(this).data("dots"):0,duration:-1!=$(this).data("animation_type")?$(this).data("duration"):0,power:-1!=$(this).data("animation_type")?$(this).data("power"):0,animation_type:$(this).data("animation_type"),css_general:$(this).data("css_general")?$(this).data("css_general"):void 0,css_active_positive:$(this).data("css_active_positive")?$(this).data("css_active_positive"):void 0,css_inactive_positive:$(this).data("css_inactive_positive")?$(this).data("css_inactive_positive"):void 0,css_active_negative:$(this).data("css_active_negative")?$(this).data("css_active_negative"):void 0,css_inactive_negative:$(this).data("css_inactive_negative")?$(this).data("css_inactive_negative"):void 0}}),$(".data-table tbody tr").each(function(){-1!=(i=$(this).data("id"))&&(c[i]={source:$(this).data("source"),alias:$(this).data("alias")})}),r.elements=o,r.animation=configuration.animation,r.animation_configuration=configuration.animation_configuration,r.line=configuration.line,r.defs=s,r.lines=l,r.animations=n,r.datasources=c,$("#save_output").val(JSON.stringify(r,void 0,4)),localMode?(e||successMessage(translateWord("succ_msg_local_output")),configuration.basic=r.basic):(socket.emit("sendTo",adapterNameNamespace,"_storeBackup",backup_configuration,function(e){e&&e.error?console.log("An error occured, while saving the backup. The following error was provided: ",e.error):(console.log(e.data),getBackups("backup_list"))}),socket.emit("setState",objID[0],{val:JSON.stringify(r),ack:!0},function(t){t?(console.log(t),e||failedMessage(translateWord("failmsg_save_workspace"))):(e||successMessage(translateWord("succ_msg_save_workspace")),configuration.basic=r.basic)}))):e||failedMessage(translateWord("failmsg_save_workspace_no_elm")),t&&t()}function getBackups(e){socket.emit("sendTo",adapterNameNamespace,"_getBackups",{},function(t){if(t&&t.error)console.log("An error occured, while receiving the backups. The following error was provided: ",t.error);else{t.data.sort((e,t)=>-1*e.localeCompare(t)),$("#"+e).empty().append(new Option(translateWord("opt_please_choose"),"-1"));let a;t.data.length>0?t.data.forEach(t=>{let i=new Date(parseInt(t)).toLocaleString("de-DE",{hour:"numeric",minute:"numeric",day:"2-digit",month:"2-digit",year:"numeric",second:"2-digit",hour12:!1});a=new Option(i,t),$("#"+e).append(a)}):($("#"+e).empty(),a=new Option(translateWord("opt_no_backups"),-1),$("#"+e).append(a))}})}function startIconObserver(){let e=new MutationObserver(function e(t){let a=[];for(let{addedNodes:i}of t)for(let r of i)r.tagName&&"svg"!=r.tagName.toLowerCase()&&(r.classList.contains("iconify")?a.push(r):r.firstElementChild&&a.push(...r.getElementsByClassName("iconify")));a.forEach(function(e,t){loadIconViaProxy($(e).data("icon"),$(e))})});e.observe(document,{childList:!0,subtree:!0})}function loadIconViaProxy(e,t){let a="http://"+hostname+":"+globalIconProxyPort+"/";if(localMode&&(a="http://192.168.2.19:"+globalIconProxyPort+"/"),"svg"!=$(this).prop("tagName"))try{$.ajax({minLength:1,url:a,dataType:"jsonp",async:!0,cache:!0,type:"GET",data:{serve:"icon",icon:e,width:t.data("width"),height:t.data("height")},success:function(e){let a=$($.parseHTML(e.icon)),i=t.attr("title");"Icon not found!"==e.message&&(i=e.message),a.data(t.data()).attr({id:t.attr("id"),class:t.attr("class"),style:t.attr("style"),title:i,x:t.attr("x"),y:t.attr("y"),width:t.attr("width"),height:t.attr("height")}).data("icon_status",e.status),t.replaceWith(a)},error:function(t){console.error("Error while receiving icon "+e+" "+JSON.stringify(t))},timeout:2e3})}catch(i){console.log("Error!"+i)}else console.log("Already iconified!")}function makeDraggable(e){var t=e.target;function a(){$("#svg_preview").removeClass("noscroll")}function i(e){var a=t.getScreenCTM();return e.touches&&(e=e.touches[0]),{x:parseInt((e.clientX-a.e)/a.a),y:parseInt((e.clientY-a.f)/a.d)}}t.addEventListener("mousedown",g),t.addEventListener("touchstart",g),t.addEventListener("mousemove",p),t.addEventListener("touchmove",p),t.addEventListener("mouseup",u),t.addEventListener("touchend",u),t.addEventListener("touchleave",u),t.addEventListener("touchcancel",u),t.addEventListener("keydown",function e(t){$(".anim_element").removeClass("animation").addClass("no_animation"),hideConfigBar();let a=!1,i=!1;if(Object.keys(o).length>0)for(var r of(s=!0,globalConfigChanged=!0,$("#svg_preview").addClass("noscroll"),Object.keys(o))){let l=o[r],n=l.id,c=0,d=0;$("#"+n).addClass("dragging");let g={x:0,y:0};switch(t.keyCode){case 39:g.x=1;break;case 37:g.x=-1;break;case 38:g.y=-1;break;case 40:g.y=1}switch(l.type){case"circle":c=parseInt($("#"+n).attr("cx")),d=parseInt($("#"+n).attr("cy")),c+g.x-l.stroke_width>=l.circle_radius&&c+g.x<l.max.x&&!a?$("#"+n).attr("cx",c+g.x):a=!0,d+g.y-l.stroke_width>=l.circle_radius&&d+g.y<l.max.y&&!i?$("#"+n).attr("cy",d+g.y):i=!0;break;case"rect":c=parseInt($("#"+n).attr("x")),d=parseInt($("#"+n).attr("y")),c+g.x-l.stroke_width>=0&&c+g.x<l.max.x&&!a?$("#"+n).attr("x",c+g.x):a=!0,d+g.y-l.stroke_width>=0&&d+g.y<l.max.y&&!i?$("#"+n).attr("y",d+g.y):i=!0;break;case"text":c=parseInt($("#"+n).attr("x")),d=parseInt($("#"+n).attr("y")),c+g.x-l.font_size>0&&c+g.x<l.max.x&&!a?$("#"+n).attr("x",c+g.x):a=!0,d+g.y-l.font_size/2>0&&d+g.y<l.max.y&&!i?$("#"+n).attr("y",d+g.y):i=!0;break;case"image":case"svg":c=parseInt($("#"+n).attr("x")),d=parseInt($("#"+n).attr("y")),c+g.x>0&&c+g.x<l.max.x&&!a?$("#"+n).attr("x",c+g.x):a=!0,d+g.y>0&&d+g.y<l.max.y&&!i?$("#"+n).attr("y",d+g.y):i=!0}if(l.reconnect_elements)for(var p of l.reconnect_elements)connectElements(p.path,p.from,p.to)}else $(".draggable-multi, .draggable-multi-group").each(function(){o[this.id]={id:this.id,type:this.tagName}}),h(t,o)}),t.addEventListener("keyup",a);let r={},o={},s=!1,l=!1,n=!1,c=!1,d;function h(e,t){let a={},r=parseInt($("#svg_config").attr("height")),o=parseInt($("#svg_config").attr("width")),s;for(var l of Object.keys(t)){let n=t[l].id;s=$("path[id*="+n+"]");let c=[];s.length>0&&s.each(function(e){let t=s[e].id.split("_");c.push({path:s[e].id,from:t[1],to:t[2]})});let d=parseInt($("#"+n).css("strokeWidth"))/2,h=parseInt($("#"+n).attr("r")),g=$("#"+n).css("font-size").replace("px",""),p=i(e);switch(t[l].type){case"circle":a.x=o-h-d,a.y=r-h-d,p.x-=parseInt($("#"+n).attr("cx")),p.y-=parseInt($("#"+n).attr("cy"));break;case"rect":a.x=o-parseInt($("#"+n).attr("width"))-d,a.y=r-parseInt($("#"+n).attr("height"))-d,p.x-=parseInt($("#"+n).attr("x")),p.y-=parseInt($("#"+n).attr("y"));break;case"text":a.x=o-g,a.y=r-g/2,p.x-=parseInt($("#"+n).attr("x")),p.y-=parseInt($("#"+n).attr("y"));break;case"image":case"svg":a.x=o-parseInt($("#"+n).attr("width")),a.y=r-parseInt($("#"+n).attr("height")),p.x-=parseInt($("#"+n).attr("x")),p.y-=parseInt($("#"+n).attr("y"))}t[l].stroke_width=d,t[l].font_size=g,t[l].circle_radius=h,t[l].offset=p,t[l].max=a,t[l].reconnect_elements=c}}function g(e){if(e.target.classList.contains("draggable")&&(r[e.target.id]={id:e.target.id,type:e.target.tagName}),e.target.parentNode.classList.contains("draggable-group")&&(r[e.target.parentNode.id]={id:e.target.parentNode.id,type:e.target.parentNode.tagName}),(e.target.classList.contains("draggable-multi")||e.target.parentNode.classList.contains("draggable-multi-group")||$(e.target).closest("svg").hasClass("draggable-multi-group"))&&$(".draggable-multi, .draggable-multi-group").each(function(){r[this.id]={id:this.id,type:this.tagName}}),$(e.target).closest("svg").hasClass("draggable")){let t=$(e.target).closest("svg").attr("id");r[t]={id:t,type:$(e.target).closest("svg").prop("tagName")}}if(e.target.classList.contains("lasso")&&(n=!0,d=i(e),$(".draggable-multi").removeClass("draggable-multi").addClass("draggable"),$(".draggable-multi-group").removeClass("draggable-multi-group").addClass("draggable draggable-group")),Object.keys(r).length>0){var a;s=!1,h(a=e,r)}}function p(e){if(n){r={},o={},l=!0;var t=i(e);if(c)$("#lasso_rect").attr({x:Math.min(d.x,t.x),y:Math.min(d.y,t.y),width:Math.abs(d.x-t.x),height:Math.abs(d.y-t.y)});else{let a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("x",d.x),a.setAttribute("y",d.y),a.setAttribute("width",0),a.setAttribute("height",0),a.setAttribute("rx",0),a.setAttribute("id","lasso_rect"),a.setAttribute("style","stroke: var(--primary); stroke-width: 2px; fill: var(--secondary); fill-opacity:0.2;"),$(a).appendTo("#placeholder_lasso"),c=!0}}if(Object.keys(r).length>0){$("#svg_preview").addClass("noscroll"),$(".anim_element").removeClass("animation").addClass("no_animation"),hideConfigBar();let h=!1,g=!1;for(var p of(s=!0,globalConfigChanged=!0,Object.keys(r))){let u=r[p],m=u.id;var t=i(e);switch($("#"+m).addClass("dragging"),u.type){case"circle":t.x-u.offset.x-u.stroke_width>=u.circle_radius&&t.x-u.offset.x<=u.max.x&&!h?$("#"+m).attr("cx",t.x-u.offset.x):h=!0,t.y-u.offset.y-u.stroke_width>=u.circle_radius&&t.y-u.offset.y<=u.max.y&&!g?$("#"+m).attr("cy",t.y-u.offset.y):g=!0;break;case"rect":t.x-u.offset.x-u.stroke_width>=0&&t.x-u.offset.x<=u.max.x&&!h?$("#"+m).attr("x",t.x-u.offset.x):h=!0,t.y-u.offset.y-u.stroke_width>=0&&t.y-u.offset.y<=u.max.y&&!g?$("#"+m).attr("y",t.y-u.offset.y):g=!0;break;case"text":t.x-u.offset.x-u.font_size>=0&&t.x-u.offset.x<=u.max.x&&!h?$("#"+m).attr("x",t.x-u.offset.x):h=!0,t.y-u.offset.y-u.font_size/2>=0&&t.y-u.offset.y<=u.max.y&&!g?$("#"+m).attr("y",t.y-u.offset.y):g=!0;break;case"image":case"svg":t.x-u.offset.x>=0&&t.x-u.offset.x<=u.max.x&&!h&&$("#"+m).attr("x",t.x-u.offset.x),t.y-u.offset.y>=0&&t.y-u.offset.y<=u.max.y&&!g&&$("#"+m).attr("y",t.y-u.offset.y)}if(u.reconnect_elements)for(var v of u.reconnect_elements)connectElements(v.path,v.from,v.to)}}}function u(e){let t=null;if(null!=n){if(n=null,c=!1,d=null,l){let i={start_x:parseInt($("#lasso_rect").attr("x")),start_y:parseInt($("#lasso_rect").attr("y")),end_x:parseInt($("#lasso_rect").attr("x"))+parseInt($("#lasso_rect").attr("width")),end_y:parseInt($("#lasso_rect").attr("y"))+parseInt($("#lasso_rect").attr("height"))};$(".added_elements").each(function(){let e=getCoords(this.id);e.x>i.start_x&&e.x+e.width<i.end_x&&e.y>i.start_y&&e.y+e.height<i.end_y&&($(this).closest("svg").hasClass("draggable-group")?$(this).closest("svg").removeClass("draggable-group draggable").addClass("draggable-multi-group"):$("#"+this.id).removeClass("draggable").addClass("draggable-multi"))}),a()}l=!1,$("#lasso_rect").remove()}if(Object.keys(r).length>0){if($(".added_elements").removeClass("dragging"),a(),t=setTimeout(function(){$("#enable_animation").prop("checked")&&$(".anim_element").removeClass("no_animation").addClass("animation")},1e3),!1===s){$(".draggable-multi").removeClass("draggable-multi").addClass("draggable"),$(".draggable-multi-group").removeClass("draggable-multi-group").addClass("draggable draggable-group");let h=Object.keys(r)[0];showConfigBar(h,r[h].type)}o=r,r={}}}}$(function(){$(document).tooltip({position:{my:"center bottom-20",at:"center top",collision:"flipfit"},content:function(){return $(this).attr("title")}}),$("input:radio[name=tabs]").click(function(){hideIframe(),hideConfigBar(),$("#align_elements").click(),$("#connect_elements").hasClass("red")&&$("#connect_elements").click()}),$("#show_hide_config").click(function(){$("#container_menu").toggle("slow")}),$("#tab4").click(function(){getDataSources("calc_battery_percent",$("#calc_battery_percent").val(),!0),getDataSources("calc_battery_charge",$("#calc_battery_charge").val(),!0),getDataSources("calc_battery_discharge",$("#calc_battery_discharge").val(),!0),getDataSources("calc_consumption_production",$("#calc_consumption_production").val(),!1),getDataSources("calc_consumption_gridFeed",$("#calc_consumption_gridFeed").val(),!0),getDataSources("calc_consumption_gridConsume",$("#calc_consumption_gridConsume").val(),!0),getDataSources("calc_consumption_batteryCharge",$("#calc_consumption_batteryCharge").val(),!0),getDataSources("calc_consumption_batteryDischarge",$("#calc_consumption_batteryDischarge").val(),!0),$("#calc_consumption_production").multiselect(multiselect_options)}),$(".tt-element").click(function(){$(".ui-tooltip").fadeOut()}),$(".line_preview").change(function(){linePreview(this.id)}),$("#elm_select").on("change",function(){showConfigBar($(this).val(),$("#"+$(this).val()).prop("tagName"))}),$(".svg_size_value").on("input change",function(e){0>=$(this).val()&&""!=$(this).val()?$(this).val(1):($("#svg_width_slider").val($("#svg_width_value").val()),$("#svg_height_slider").val($("#svg_height_value").val()),resizeSVG())}),$(".svg_size_slider").on("input change",function(){$("#svg_height_value").val($("#svg_height_slider").val()),$("#svg_width_value").val($("#svg_width_slider").val()),resizeSVG()}),$(".align_elements").click(function(e){globalConfigChanged=!0,globalLastSteps={},$(".added_elements").removeClass("alignable").addClass("draggable"),$(".all_elements, .align_elements").removeClass("faded_out");let t=e.target.id,a,i;""==t&&(t=$(this).closest("a").attr("id")),$(".align_elements:not(#"+t+")").addClass("faded_out"),$("#align_elements, #undo_align_elements").show(),$("#all_undo_align_elements").css("display","inline-flex"),$("#connect_elements").prop("disabled",!0),hideConfigBar(),$(".all_elements").addClass("faded_out"),$(".added_elements").removeClass("draggable faded_out").addClass("alignable"),$(".type_icon").removeClass("draggable-group").addClass("alignable"),$("#ex_how_align").html(translateWord("ex_align_ref")+" <img src='img/icon_help.png' class='help' style='vertical-align: bottom;' placeholder='"+translateWord("ex_align_help")+"'>"),$(".alignable").off().click(function(e){let r=e.target.id;if(null==i)""==(r=e.target.id)&&(r=e.target.parentNode.id),a=getCoords(r),i=getSlots(a),$("#ex_how_align").html(translateWord("ex_align_ref_selected"));else{let o=e.target.tagName.toLowerCase();switch(""==(r=e.target.id)&&(r=e.target.parentNode.id,o=e.target.parentNode.tagName),globalLastSteps[r]={},t.replace("align_","")){case"center":switch(o){case"circle":globalLastSteps[r].cx=$("#"+r).attr("cx"),$("#"+r).attr("cx",i.top.x);break;case"rect":case"svg":globalLastSteps[r].x=$("#"+r).attr("x"),$("#"+r).attr("x",i.top.x-Math.floor(parseInt($(this).attr("width"))/2));break;case"text":globalLastSteps[r].x=$("#"+r).attr("x"),$("#"+r).attr("x",i.top.x)}break;case"left":switch(o){case"circle":globalLastSteps[r].cx=$("#"+r).attr("cx"),$("#"+r).attr("cx",i.left.x+parseInt($(this).attr("r"))+Math.floor(parseInt($(this).css("stroke-width"))/2));break;case"rect":case"svg":globalLastSteps[r].x=$("#"+r).attr("x"),$("#"+r).attr("x",i.left.x+Math.floor(parseInt($(this).css("stroke-width"))/2));break;case"text":globalLastSteps[r].x=$("#"+r).attr("x"),$("#"+r).attr("x",i.left.x+Math.floor(e.target.getComputedTextLength()/2))}break;case"right":switch(o){case"circle":globalLastSteps[r].cx=$("#"+r).attr("cx"),$("#"+r).attr("cx",i.right.x-parseInt($(this).attr("r"))-Math.floor(parseInt($(this).css("stroke-width"))/2));break;case"rect":case"svg":globalLastSteps[r].x=$("#"+r).attr("x"),$("#"+r).attr("x",i.right.x-Math.floor(parseInt($(this).attr("width")))-Math.floor(parseInt($(this).css("stroke-width"))/2));break;case"text":globalLastSteps[r].x=$("#"+r).attr("x"),$("#"+r).attr("x",i.right.x-Math.floor(e.target.getComputedTextLength()/2))}break;case"vcenter":switch(o){case"circle":globalLastSteps[r].cy=$("#"+r).attr("cy"),$("#"+r).attr("cy",i.right.y);break;case"rect":case"svg":globalLastSteps[r].y=$("#"+r).attr("y"),$("#"+r).attr("y",i.right.y-Math.floor(parseInt($(this).attr("height"))/2));break;case"text":globalLastSteps[r].y=$("#"+r).attr("y"),$("#"+r).attr("y",i.right.y)}break;case"top":switch(o){case"circle":globalLastSteps[r].cy=$("#"+r).attr("cy"),$("#"+r).attr("cy",i.top.y+parseInt($(this).attr("r"))+Math.floor(parseInt($(this).css("stroke-width"))/2));break;case"rect":case"svg":globalLastSteps[r].y=$("#"+r).attr("y"),$("#"+r).attr("y",i.top.y+Math.floor(parseInt($(this).css("stroke-width"))/2));break;case"text":globalLastSteps[r].y=$("#"+r).attr("y"),$("#"+r).attr("y",i.top.y+Math.floor(parseInt($(this).css("font-size"))/2))}break;case"bottom":switch(o){case"circle":globalLastSteps[r].y=$("#"+r).attr("y"),$("#"+r).attr("cy",i.bottom.y-parseInt($(this).attr("r"))-Math.floor(parseInt($(this).css("stroke-width"))/2));break;case"rect":case"svg":globalLastSteps[r].y=$("#"+r).attr("y"),$("#"+r).attr("y",i.bottom.y-Math.floor(parseInt($(this).attr("height")))-Math.floor(parseInt($(this).css("stroke-width"))/2));break;case"text":globalLastSteps[r].y=$("#"+r).attr("y"),$("#"+r).attr("y",i.bottom.y-Math.floor(parseInt($(this).css("font-size"))/2))}}let s=Object.keys(globalLastSteps).length;s>0?($("#undo_align_elements").prop("disabled",!1),$("#undo_steps").text("(Saved Steps: "+s+")")):$("#undo_align_elements").prop("disabled",!0);let l=$("path[id*="+r+"]");l.length>0&&l.each(function(e){let t=l[e].id.split("_");connectElements(l[e].id,t[1],t[2])})}})}),$("#align_elements, #undo_align_elements").click(function(){let e=Object.keys(globalLastSteps=(reverseObj=e=>Object.keys(e).reverse().reduce((t,a,i)=>(t[a]=e[a],t),{}))(globalLastSteps)).length;if("undo_align_elements"==this.id){let t=Object.keys(globalLastSteps)[e-1];e>0&&Object.entries(globalLastSteps[t]).forEach(a=>{let[i,r]=a;console.log("Restoring Element: "+t+" with "+i+" and Value: "+r),$("#"+t).attr(i,r);let o=$("path[id*="+t+"]");o.length>0&&o.each(function(e){let t=o[e].id.split("_");connectElements(o[e].id,t[1],t[2])}),delete globalLastSteps[t],(e=Object.keys(globalLastSteps).length)>0?$("#undo_steps").text(translateWord("ex_align_saved_steps")+e+")"):($("#undo_steps").text(translateWord("ex_align_undo_steps")+":"),$("#undo_align_elements").prop("disabled",!0))})}else $("#ex_how_align").html(translateWord("ex_align")),$("#connect_elements").prop("disabled",!1),$("#align_elements, #undo_align_elements").hide(),$("#all_undo_align_elements").css("display","none"),$("#undo_steps").text(translateWord("ex_align_undo_steps")+":"),$("#undo_align_elements").prop("disabled",!0),$(".alignable").off(),$(".added_elements").removeClass("alignable").addClass("draggable"),$(".type_icon").removeClass("alignable").addClass("draggable-group"),$(".all_elements, .align_elements").removeClass("faded_out")}),$("#duplicate_elements").click(function(){globalConfigChanged=!0;let e=[],t=[],a={};if(0==$(".draggable-multi, .draggable-multi-group").length?$("#elm_select").val()?e.push($("#elm_select").val()):failedMessage(translateWord("failmsg_duplicate_no_elm")):$(".draggable-multi, .draggable-multi-group").each(function(){e.push(this.id)}),e.length>0){for(let i=0;i<e.length;i++){generateMaxID(),a={id:max_elm_id,subType:$("#"+e[i]).data("type")?$("#"+e[i]).data("type"):"",format:$("#"+e[i]).prop("tagName"),radius:$("#"+e[i]).attr("r"),height:$("#"+e[i]).attr("height"),width:$("#"+e[i]).attr("width"),color:$("#"+e[i]).css("stroke"),stroke:$("#"+e[i]).css("stroke-width").replace("px",""),fill:$("#"+e[i]).css("fill"),font_family:$("#"+e[i]).css("font-family"),font_size:$("#"+e[i]).css("font-size").replace("px",""),align:$("#"+e[i]).css("text-anchor"),shadow:getShadowColor(e[i]),degree:getRotationDegrees($("#"+e[i])),pos_x:parseInt($("#"+e[i]).attr("x")||$("#"+e[i]).attr("cx"))+15,pos_y:parseInt($("#"+e[i]).attr("y")||$("#"+e[i]).attr("cy"))+15,rx:$("#"+e[i]).attr("rx"),text:$("#"+e[i]).text(),svg_content:$("#"+e[i]).html(),href:$("#"+e[i]).attr("href"),preserveAspectRatio:$("#"+e[i]).attr("preserveAspectRatio")};let r=$("#"+e[i]).data();for(var o of Object.keys(r)){let s=r[o];a[o]=s||""}1==e.length?addElement(a,function(){showConfigBar(a.id,a.format),successMessage(translateWord("succ_msg_duplicate"))}):addElement(a),t.push(a.id)}if(t.length>1){successMessage(translateWord("succ_msg_duplicate")),$(".draggable-multi").removeClass("draggable-multi").addClass("draggable"),$(".draggable-multi-group").removeClass("draggable-multi-group").addClass("draggable draggable-group"),hideConfigBar();for(let l=0;l<t.length;l++)$("#"+t[l]).hasClass("draggable-group")?$("#"+t[l]).removeClass("draggable-group draggable").addClass("draggable-multi-group"):$("#"+t[l]).removeClass("draggable").addClass("draggable-multi")}}}),$(".add_element").click(function(e){globalConfigChanged=!0,0===$(".added_elements").length?max_elm_id=0:generateMaxID();let t={id:max_elm_id,width:parseInt(configuration.basic.rect.width)||100,height:parseInt(configuration.basic.rect.height)||100,stroke:parseInt(configuration.basic.elm.stroke_width)||5,pos_x:(parseInt(configuration.basic.elm.pos_x)||50)+getRandomInt(50),pos_y:(parseInt(configuration.basic.elm.pos_y)||50)+getRandomInt(50),color:configuration.basic.elm.color||getRandomRGBA(),fill:configuration.basic.elm.fill||"none",font_size:configuration.basic.font.size||20,font_family:configuration.basic.font.family||'"Arial", sans-serif',css_general:"",css_active_positive:"",css_inactive_positive:"",css_active_negative:"",css_inactive_negative:"",source:-1,threshold:0,frame:"_overlay",url:"",action:"none"},a=e.target.id;switch(""==a&&(a=$(this).closest("a").attr("id")),a){case"add_circle":t.radius=configuration.basic.circle.radius||50,t.format="circle",t.fill_value="",t.fill_type=-1,t.fill_direction=90,t.fill_max=0,t.border_value="",t.border_type=-1,t.border_direction="cw",t.border_style="round",t.border_max=0,t.border_reverse_value="",t.border_reverse=!1,t.border_start=180;break;case"add_rect":t.format="rect",t.rx=configuration.basic.rect.corners||10,t.fill_value="",t.fill_type=-1,t.fill_direction="cw",t.fill_max=0,t.border_value="",t.border_type=-1,t.border_direction="cw",t.border_style="round",t.border_max=0,t.border_reverse_value="",t.border_reverse=!1,t.border_start=180;break;case"add_text":t.format="text",t.text="Text",t.align="middle";break;case"add_datasource":t.calculate_kw=!1,t.convert=!1,t.decimal_places=0,t.format="text",t.align="middle",t.subType="datasource",t.text="Datasource "+max_elm_id,t.source_option=-1,t.source_display="value",t.subtract="[-1]",t.unit="kW",t.append="",t.prepend="";break;case"add_icon":t.format="icon",t.width=24,t.height=24,t.icon="mdi:omega",t.color=configuration.basic.icon.color||getRandomRGBA();break;case"add_svg":t.svg_content='<path d="M19.564 4.42a.75.75 0 0 0-1.378-.59l-6.75 15.75a.75.75 0 0 0 1.378.59l6.75-15.75ZM7 18.5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0Z" fill="currentColor"></path>',t.subType="svg",t.format="svg",t.width=24,t.height=24;break;case"add_image":t.href="img/tmp_img.png",t.width=100,t.height=100,t.format="image",t.preserveAspectRatio="xMidYMid meet"}("text"==t.format||"datasource"==t.format)&&(t.fill=t.color,t.color=""),addElement(t)}),$("#enable_animation").on("click change",function(){$(this).is(":checked")?$(".anim_element").removeClass("no_animation").addClass("animation"):$(".anim_element").removeClass("animation").addClass("no_animation")}),$("#enable_grid").on("click change",function(){$(this).is(":checked")?$("#help_grid").fadeIn("fast"):$("#help_grid").fadeOut("fast")}),$("#enable_last_id").on("click",function(){configuration.basic.enable_last_id=$(this).is(":checked"),console.log("Showing last ID: "+$(this).is(":checked"))}),$("#config_close").click(function(){hideConfigBar()}),$("#config_swap").click(function(){$("#config_bar").hasClass("left")?$("#config_bar").removeClass("left show").addClass("right show"):$("#config_bar").removeClass("right show").addClass("left show")}),$("#iframe_close").click(function(){hideIframe()}),$(".stateExplorer_close").click(function(){hideStateExplorer()}),$("#enable_area_catch").on("click change",function(){$(this).is(":checked")?$("#svg_preview").addClass("svg_preview_catch"):$("#svg_preview").removeClass("svg_preview_catch")}),$(".connect_elements").click(function(){let e=$(".line:not(.faded_out, .preview)"),t=event.target.id,a="#ex_how_reconnect";"connect_elements"==t?(a="#ex_how_connect",$("#reconnect_elements").prop("disabled",!0)):$("#connect_elements").prop("disabled",!0);let i,r,o,s;$(this).hasClass("red")?($(".clickable").off(),$(".added_elements").removeClass("clickable").addClass("draggable"),$(".all_elements").removeClass("faded_out no_click"),"connect_elements"==t?($(a).html(translateWord("ex_connect")),$(this).val(translateWord("value_connect")).removeClass("red")):($(a).html(translateWord("ex_reconnect")),$(this).val(translateWord("value_reconnect")).removeClass("red")),$(".clickable").off(),showConnectionPoints(!1),$(".connect_elements").prop("disabled",!1)):$(".connector").length>=2?("connect_elements"==t&&hideConfigBar(),showConnectionPoints(),"connect_elements"==t?$(a).html(translateWord("ex_connect_ref")+" <img src='img/icon_help.png' class='help' style='vertical-align: bottom;' placeholder='"+translateWord("help_connect")+"'>"):$(a).html(translateWord("ex_reconnect_ref")),$(".all_elements").addClass("faded_out no_click"),"reconnect_elements"==t&&$("#"+e[0].id+", #"+e[0].id.replace("anim","line")).removeClass("faded_out"),$(".connector").removeClass("draggable faded_out no_click").addClass("clickable"),$(".clickable").off().click(function(){let l=$(this).attr("id");if(l||(l=$(this).data("element")),null==i)i=l,o=$(this).data("slot"),$(a).html(translateWord("ex_connect_start"));else if(i==l)$(a).html(translateWord("ex_connect_same")),r=null,s=null;else{r=l,s=$(this).data("slot");let n="path_"+i+"_"+r;if($("#"+n).length>0)"connect_elements"==t?failedMessage(translateWord("failmsg_conn_exists")):($("#"+n).data({"start-slot":o,"end-slot":s}),connectElements(n,i,r),showConfigBar("line_"+n,"use"),globalConfigChanged=!0);else{if(addElement({format:"def",id:n,connPoint1:o,connPoint2:s,d:""}),connectElements(n,i,r),"reconnect_elements"==t){if(1==e.length){let c=$("#"+e[0].id),d=$("#"+e[0].id.replace("line_","")),h=$("#"+e[0].id.replace("line","anim"));addElement({format:"line",id:"line_"+n,color:c.css("stroke"),href:"#"+n,shadow:getShadowColor(c.attr("id"))}),addElement({format:"animation",id:"anim_"+n,color:h.css("stroke"),href:"#"+n,source:h.data("source"),animation_properties:h.data("animation_properties"),animation_option:h.data("animation_option"),threshold:h.data("threshold"),dots:h.data("dots"),duration:h.data("duration"),power:h.data("power"),animation_type:h.data("animation_type"),css_general:h.data("css_general"),css_active_positive:h.data("css_active_positive"),css_inactive_positive:h.data("css_inactive_positive"),css_active_negative:h.data("css_active_negative"),css_inactive_negative:h.data("css_inactive_negative")}),h.remove(),c.remove(),d.remove(),showConfigBar("line_"+n,"use")}}else addElement({format:"line",id:"line_"+n,color:configuration.line.stroke,href:"#"+n}),addElement({format:"animation",id:"anim_"+n,color:configuration.animation.stroke,href:"#"+n,source:-1,animation_properties:"positive",animation_option:!1,threshold:null,dots:null,duration:null,power:null,animation_type:-1,css_general:"",css_active_positive:"",css_inactive_positive:"",css_active_negative:"",css_inactive_negative:""});globalConfigChanged=!0}showConnectionPoints(!1),i=null,r=null,"connect_elements"==t?($(a).html(translateWord("ex_connect")),$("#connect_elements").val(translateWord("value_connect")).removeClass("red")):($(a).html(translateWord("ex_reconnect")),$("#reconnect_elements").val(translateWord("value_reconnect")).removeClass("red")),$(".connect_elements").prop("disabled",!1),$(".clickable").off(),$(".added_elements").removeClass("clickable").addClass("draggable");let g;g="connect_elements"==t?"no_click faded_out":"no_click",$(".all_elements").removeClass(g)}}),$(this).val(translateWord("value_cancel")).addClass("red")):failedMessage(translateWord("failmsg_no_elements"))}),$("#save_workspace, #save_workspace_exit").click(function(){globalConfigChanged=!1,"save_workspace_exit"==this.id?saveWorkspace(!1,function(){window.location.replace("index.html?instance="+instance)}):saveWorkspace(!1)}),$("#workspace_exit").click(function(){window.location.replace("index.html?instance="+instance)}),$("#restore_backup").click(function(){let e=$("#backup_list").val();-1!=e&&""!=e&&null!=e?$("#backup_section").html(systemDictionary.msg_backup_restore[systemLang]).dialog({resizable:!1,height:"auto",maxHeight:"100%",closeText:"X",width:400,modal:!0,open:function(e,t){$(".ui-dialog-titlebar-close").attr({title:translateWord("btn_close"),tabIndex:-1}).blur()},buttons:[{text:translateWord("value_save_restore"),click:function(){$(this).dialog("close"),socket.emit("sendTo",adapterNameNamespace,"_restoreBackup",{fileName:e},function(e){e&&e.error?(console.log("An error occured, while restoring the backup. The following error was provided: ",e.error),failedMessage(translateWord("failmsg_backup"))):(configuration=e.data,console.log(e.data),setLoadedConfig(),successMessage(translateWord("succ_msg_backup")))})}},{text:translateWord("value_cancel"),click:function(){$(this).dialog("close"),failedMessage(translateWord("failmsg_backup_cancel"))}}]}):failedMessage(translateWord("failmsg_backup_no_valid"))})}),$(document).ready(function(){let e={source:function(e,t){var a=RegExp("^"+$.ui.autocomplete.escapeRegex(e.term),"i");t($.grep(iobArray,function(e){return a.test(e)}))},classes:{"ui-autocomplete":"ui-autocomplete-ds"},minLength:3,delay:500};$("body").on("click",function(){$(document).off("keydown")}),$(window).on("beforeunload",function(){if(globalConfigChanged)return translateWord("leave_unsaved")}),$("body").on("click",".help",function(){$("#help_section").html($(this).attr("placeholder")).dialog({resizable:!1,height:"auto",maxHeight:"100%",width:400,open:function(e,t){$(".ui-dialog-titlebar-close").attr({title:translateWord("btn_close"),tabIndex:-1}).blur()}})}),$("#frm-addDataSource").submit(function(e){e.preventDefault(),globalConfigChanged=!0;let t=$("#elm_ds_source").val(),a=$("#elm_ds_alias").val()?$("#elm_ds_alias").val():"";addDataSourceRow(-1,t,a),$("#elm_ds_source, #elm_ds_alias").val("")}),$(".data-table").on("click",".btn-delete",function(){globalConfigChanged=!0;let e=!0,t=$(this).parents("tr").data("id");$(".all_elements").each(function(){if($(this).data("source")==t)return e=!1,!1}),e?$(this).parents("tr").fadeOut("fast",function(){$(this).remove(),0==$(".data-table tbody tr").length&&$(".data-table tbody").append("<tr id='ds_tmp_line' data-id='-1'><td>"+translateWord("no_ds_added")+"</td><td></td><td></td>")}):failedMessage(translateWord("failmsg_delete_source"))}),$(".data-table").on("click",".btn-edit",function(){$(".btn-edit").prop("disabled",!0);let t=$(this).parents("tr").attr("data-alias"),a=$(this).parents("tr").attr("data-source");$(this).parents("tr").find("td:eq(0)").html('<div class="form_div no_margin"><input type="text" class="input_text" id="edit_ds_alias" name="edit_ds_alias" autocorrect="off" autocomplete="off" value="'+t+'"></div>'),$(this).parents("tr").find("td:eq(1)").html('<div class="form_div no_margin"><input type="text" class="input_text icon_in_input_pad datasource_autocomplete" id="edit_ds_source" name="edit_ds_source" autocorrect="off" autocomplete="off" minlength="3" required="" value="'+a+'"><div class="icon_wrapper"><a class="datasource icon_in_input"><span class="iconify" data-icon="mdi:database-search" data-height="24"></span></a></div></div>'),$(this).parents("tr").find("td:eq(2)").prepend("<button class='all_datasource ds_buttons btn-update'><span class='iconify' data-height='24' data-icon='mdi:check'>Update</span></button><button class='all_datasource ds_buttons btn-cancel'><span class='iconify' data-height='24' data-icon='mdi:close'>Close</span></button>"),$(this).hide(),isMobileDevice||$(".datasource_autocomplete").autocomplete(e)}),$(".data-table").on("click",".btn-cancel",function(){$(".btn-edit").prop("disabled",!1);let e=$(this).parents("tr").attr("data-alias"),t=$(this).parents("tr").attr("data-source");$(this).parents("tr").find("td:eq(0)").text(e),$(this).parents("tr").find("td:eq(1)").text(t),$(this).parents("tr").find(".btn-edit").show(),$(this).parents("tr").find(".btn-update").remove(),$(this).parents("tr").find(".btn-cancel").remove()}),$(".data-table").on("click",".btn-update",function(){$(".btn-edit").prop("disabled",!1),globalConfigChanged=!0;let e=$("#edit_ds_alias").val(),t=$("#edit_ds_source").val();$(this).parents("tr").find("td:eq(0)").text(e),$(this).parents("tr").find("td:eq(1)").text(t),$(this).parents("tr").attr("data-alias",e),$(this).parents("tr").attr("data-source",t),$(this).parents("tr").find(".btn-edit").show(),$(this).parents("tr").find(".btn-cancel").remove(),$(this).parents("tr").find(".btn-update").remove()}),$(".datasource_autocomplete").autocomplete(e),$("body").on("click",".datasource",function(){let e=$(this).parent("div").parent("div").children("input").attr("id"),t=$("#"+e).val();""==$("#"+e).val()&&!0==configuration.basic.enable_last_id&&(t=globalSelectedId,console.log("Showing last ID: "+t)),$("#loading").fadeIn("fast"),$(".loading-spinner, #loading_text").fadeOut("fast"),$("#stateExplorerContainer").fadeIn("fast"),openStateTree("stateExplorer",t),$("#select_state").off().on("click",function(){let t=$(".state.active").attr("id");$("#"+e).val(t).focus(),globalSelectedId=t,hideStateExplorer()})}),displayMode&&($("body").on("mouseover",".added_elements",function(){($(this).data("url")||$(this).data("action"))&&(""!=$(this).data("url")||"none"!=$(this).data("action"))&&$(this).css({"pointer-events":"all",cursor:"pointer"})}),$("body").on("click",".added_elements",function(){if($(this).data("url")){switch($(this).data("frame")){case"_blank":case"_self":var e=window.open($(this).data("url"),$(this).data("frame"));e?e.focus():failedMessage(translateWord("failmsg_opening_frame"));break;case"_overlay":displayLoading(translateWord("msg_loading_url")),$("#overlay_frame").attr("src",$(this).data("url"))}console.log("URL found! "+$(this).data("url")+" Frame: "+$(this).data("frame"))}if($(this).data("action")){let t=$(this).data("source"),a;try{a=configuration.datasources[t].source}catch(i){console.log("No valid state found for this action!")}switch($(this).data("action")){case"default":case"none":break;case"toggle":socket.emit("getState",a,function(e,t){if(e)console.log("An error occured, while getting the state. The following error was provided: "+e);else{let i=t.val;"boolean"==typeof i?socket.emit("setState",a,{val:!i,ack:!1},function(e,t){e&&console.log("An error occured, while toggling the state. The following error was provided: "+e)}):console.error("This state can not be handled, because it is not a boolean state!")}});break;case"on":socket.emit("setState",a,{val:!0,ack:!1},function(e){e&&console.log("An error occured, while setting the state. The following error was provided: "+e)});break;case"off":socket.emit("setState",a,{val:!1,ack:!1},function(e){e&&console.log("An error occured, while setting the state. The following error was provided: "+e)})}}})),$(".data-table").on("click","th",function(){$(".sort_icon").html("");var e=$(this).parents("table").eq(0),t=e.find("tr:gt(0)").toArray().sort(dataSourceComparer($(this).index()));this.asc=!this.asc,$(this).children("span").html('<span class="iconify" data-icon="mdi:sort-alphabetical-ascending" data-height="18">'),this.asc||(t=t.reverse(),$(this).children("span").html('<span class="iconify" data-icon="mdi:sort-alphabetical-descending" data-height="18">'));for(var a=0;a<t.length;a++)e.append(t[a])}),loadConfig()});